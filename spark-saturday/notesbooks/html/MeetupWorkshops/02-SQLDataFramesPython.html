<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>02-SQLDataFramesPython - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta name="robots" content="nofollow">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/img/favicon.ico"/>
<script>window.settings = {"enableNotebookNotifications":true,"enableSshKeyUI":false,"defaultInteractivePricePerDBU":0.4,"enableOnDemandClusterType":true,"enableAutoCompleteAsYouType":[],"devTierName":"Community Edition","enableJobsPrefetching":true,"workspaceFeaturedLinks":[{"linkURI":"https://docs.databricks.com/index.html","displayName":"Documentation","icon":"question"},{"linkURI":"https://docs.databricks.com/release-notes/product/index.html","displayName":"Release Notes","icon":"code"},{"linkURI":"https://docs.databricks.com/spark/latest/training/index.html","displayName":"Training & Tutorials","icon":"graduation-cap"}],"enableClearStateFeature":true,"dbcForumURL":"http://forums.databricks.com/","enableProtoClusterInfoDeltaPublisher":true,"enableAttachExistingCluster":true,"serverlessDefaultSparkVersion":"2.2.x-scala2.11","maxCustomTags":45,"serverlessDefaultMaxWorkers":20,"enableInstanceProfilesUIInJobs":true,"nodeInfo":{"node_types":[{"support_ssh":false,"spark_heap_memory":4800,"instance_type_id":"r3.2xlarge","spark_core_oversubscription_factor":8.0,"node_type_id":"dev-tier-node","description":"Community Optimized","support_cluster_tags":false,"container_memory_mb":6000,"node_instance_type":{"instance_type_id":"r3.2xlarge","provider":"AWS","local_disk_size_gb":160,"compute_units":26.0,"number_of_ips":14,"local_disks":1,"reserved_compute_units":3.64,"gpus":0,"memory_mb":62464,"num_cores":8,"local_disk_type":"AHCI","max_attachable_disks":0,"supported_disk_types":[{"ebs_volume_type":"GENERAL_PURPOSE_SSD"},{"ebs_volume_type":"THROUGHPUT_OPTIMIZED_HDD"}],"reserved_memory_mb":4800},"memory_mb":6144,"is_hidden":false,"category":"Community Edition","num_cores":0.88,"support_port_forwarding":false,"support_ebs_volumes":false,"is_deprecated":false}],"default_node_type_id":"dev-tier-node"},"enableDatabaseSupportClusterChoice":true,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":999999,"serverlessClusterProductName":"Serverless Pool","enableTableHandler":false,"maxEbsVolumesPerInstance":10,"isAdmin":true,"deltaProcessingBatchSize":1000,"timerUpdateQueueLength":100,"enableLargeResultDownload":true,"maxElasticDiskCapacityGB":5000,"serverlessDefaultMinWorkers":2,"zoneInfos":[{"id":"us-west-2c","isDefault":true},{"id":"us-west-2b","isDefault":false},{"id":"us-west-2a","isDefault":false}],"enableCustomSpotPricingUIByTier":false,"serverlessClustersEnabled":false,"enableFindAndReplace":false,"enableEBSVolumesUIForJobs":true,"enablePublishNotebooks":true,"enableMaxConcurrentRuns":true,"enableJobAclsConfig":false,"enableFullTextSearch":false,"enableElasticSparkUI":false,"enableNewClustersCreate":true,"clusters":true,"allowRunOnPendingClusters":true,"fileStoreBase":"FileStore","enableSshKeyUIInJobs":true,"enableDetachAndAttachSubMenu":true,"configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableAdminPasswordReset":false,"enableResetPassword":true,"maxClusterTagValueLength":255,"enableJobsSparkUpgrade":true,"perClusterAutoterminationEnabled":false,"enableNotebookCommandNumbers":true,"sparkVersions":[{"key":"1.6.3-db2-hadoop2-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-aba860a0ffce4f3471fb14aefdcb1d768ac66a53a5ad884c48745ef98aeb9d67","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.1-db5-scala2.11","displayName":"Spark 2.1.1-db5 (Scala 2.11)","packageLabel":"spark-image-08d9fc1551087e0876236f19640c4a83116b1649f15137427d21c9056656e80e","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1 (Hadoop 1)","packageLabel":"spark-image-f710650fb8aaade8e4e812368ea87c45cd8cd0b5e6894ca6c94f3354e8daa6dc","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.2.x-scala2.11","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-67ab3a06d1e83d5b60df7063245eb419a2e9fe329aeeb7e7d9713332c669bb17","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.1.0-db2-scala2.11","displayName":"Spark 2.1.0-db2 (Scala 2.11)","packageLabel":"spark-image-267c4490a3ab8a39acdbbd9f1d36f6decdecebf013e30dd677faff50f1d9cf8b","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.1.x-gpu-scala2.11","displayName":"Spark 2.1 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-f43ddf8ad9acfd71338f5a51345f077173d236016ad7e39ffd6f698403acd4ea","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.0-ubuntu15.10-scala2.10","displayName":"Spark 2.0.0 (Scala 2.10)","packageLabel":"spark-image-073c1b52ace74f251fae2680624a0d8d184a8b57096d1c21c5ce56c29be6a37a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db3-scala2.10","displayName":"Spark 2.0.2-db3 (Scala 2.10)","packageLabel":"spark-image-584091dedb690de20e8cf22d9e02fdcce1281edda99eedb441a418d50e28088f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.11","displayName":"Spark 2.1.0-db1 (Scala 2.11)","packageLabel":"spark-image-e8ad5b72cf0f899dcf2b4720c1f572ab0e87a311d6113b943b4e1d4a7edb77eb","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.1.1-db4-scala2.11","displayName":"Spark 2.1.1-db4 (Scala 2.11)","packageLabel":"spark-image-52bca0ca866e3f4243d3820a783abf3b9b3b553edf234abef14b892657ceaca9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db2-scala2.10","displayName":"Spark 2.1.0-db2 (Scala 2.10)","packageLabel":"spark-image-a2ca4f6b58c95f78dca91b1340305ab3fe32673bd894da2fa8e1dc8a9f8d0478","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.6.x-ubuntu15.10-hadoop1","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.2-db4-scala2.11","displayName":"Spark 2.0.2-db4 (Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.1-ubuntu15.10-hadoop1","displayName":"Spark 1.6.1 (Hadoop 1)","packageLabel":"spark-image-21d1cac181b7b8856dd1b4214a3a734f95b5289089349db9d9c926cb87d843db","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-gpu-scala2.11","displayName":"Spark 2.0 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-968b89f1d0ec32e1ee4dacd04838cae25ef44370a441224177a37980d539d83a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop1","displayName":"Spark 1.6.2 (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.3-db1-hadoop2-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-eaa8d9b990015a14e032fb2e2e15be0b8d5af9627cd01d855df728b67969d5d9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db2-hadoop1-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-14112ea0645bea94333a571a150819ce85573cf5541167d905b7e6588645cf3b","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop2","displayName":"Spark 1.6.2 (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.1-ubuntu15.10-hadoop2","displayName":"Spark 1.6.1 (Hadoop 2)","packageLabel":"spark-image-4cafdf8bc6cba8edad12f441e3b3f0a8ea27da35c896bc8290e16b41fd15496a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db2-scala2.10","displayName":"Spark 2.0.2-db2 (Scala 2.10)","packageLabel":"spark-image-36d48f22cca7a907538e07df71847dd22aaf84a852c2eeea2dcefe24c681602f","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-ubuntu15.10-scala2.11","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.11, deprecated)","packageLabel":"spark-image-8e1c50d626a52eac5a6c8129e09ae206ba9890f4523775f77af4ad6d99a64c44","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.1-db4-scala2.10","displayName":"Spark 2.1.1-db4 (Scala 2.10)","packageLabel":"spark-image-c7c0224de396cd1563addc1ae4bca6ba823780b6babe6c3729ddf73008f29ba4","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.11","displayName":"Spark 2.0.2-db1 (Scala 2.11)","packageLabel":"spark-image-c2d623f03dd44097493c01aa54a941fc31978ebe6d759b36c75b716b2ff6ab9c","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db4-scala2.10","displayName":"Spark 2.0.2-db4 (Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.1-db5-scala2.10","displayName":"Spark 2.1.1-db5 (Scala 2.10)","packageLabel":"spark-image-74133df2c13950431298d1cab3e865c191d83ac33648a8590495c52fc644c654","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2 (Hadoop 1)","packageLabel":"spark-image-c9d2a8abf41f157a4acc6d52bc721090346f6fea2de356f3a66e388f54481698","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.2.x-scala2.10","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d549f2d4a523994ecdf37e531b51d5ec7d8be51534bb0ca5322eaad28ba8f557","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"3.0.x-scala2.11","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.11)","packageLabel":"spark-image-67ab3a06d1e83d5b60df7063245eb419a2e9fe329aeeb7e7d9713332c669bb17","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-scala2.11","displayName":"Spark 2.0 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.x-scala2.10","displayName":"Spark 2.1 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-74133df2c13950431298d1cab3e865c191d83ac33648a8590495c52fc644c654","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"3.1.x-scala2.11","displayName":"3.1 alpha (Scala 2.11)","packageLabel":"spark-image-b22eb77d602f56ac4fccde1d90398db6fc15a3bfd27a06570d0c70472e39d183","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db3-scala2.10","displayName":"Spark 2.1.0-db3 (Scala 2.10)","packageLabel":"spark-image-25a17d070af155f10c4232dcc6248e36a2eb48c24f8d4fc00f34041b86bd1626","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db2-scala2.11","displayName":"Spark 2.0.2-db2 (Scala 2.11)","packageLabel":"spark-image-4fa852ba378e97815083b96c9cada7b962a513ec23554a5fc849f7f1dd8c065a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"3.1.x-scala2.10","displayName":"3.1 alpha (Scala 2.10)","packageLabel":"spark-image-921a4c439389adacef9d3af16edd5406c30ca9195d06cc09d0c1f171c7be61ff","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0 (Hadoop 1)","packageLabel":"spark-image-40d2842670bc3dc178b14042501847d76171437ccf70613fa397a7a24c48b912","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.1-db1-scala2.11","displayName":"Spark 2.0.1-db1 (Scala 2.11)","packageLabel":"spark-image-10ab19f634bbfdb860446c326a9f76dc25bfa87de6403b980566279142a289ea","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db3-scala2.11","displayName":"Spark 2.0.2-db3 (Scala 2.11)","packageLabel":"spark-image-7fd7aaa89d55692e429115ae7eac3b1a1dc4de705d50510995f34306b39c2397","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db1-hadoop1-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-d50af1032799546b8ccbeeb76889a20c819ebc2a0e68ea20920cb30d3895d3ae","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.10","displayName":"Spark 2.0.2-db1 (Scala 2.10)","packageLabel":"spark-image-654bdd6e9bad70079491987d853b4b7abf3b736fff099701501acaabe0e75c41","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-ubuntu15.10","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.10, deprecated)","packageLabel":"spark-image-a659f3909d51b38d297b20532fc807ecf708cfb7440ce9b090c406ab0c1e4b7e","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.1-db1-scala2.10","displayName":"Spark 2.0.1-db1 (Scala 2.10)","packageLabel":"spark-image-5a13c2db3091986a4e7363006cc185c5b1108c7761ef5d0218506cf2e6643840","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.1.x-scala2.11","displayName":"Spark 2.1 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-08d9fc1551087e0876236f19640c4a83116b1649f15137427d21c9056656e80e","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.10","displayName":"Spark 2.1.0-db1 (Scala 2.10)","packageLabel":"spark-image-f0ab82a5deb7908e0d159e9af066ba05fb56e1edb35bdad41b7ad2fd62a9b546","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"3.0.x-scala2.10","displayName":"3.0 (includes Apache Spark 2.2.0, Scala 2.10)","packageLabel":"spark-image-d549f2d4a523994ecdf37e531b51d5ec7d8be51534bb0ca5322eaad28ba8f557","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.0-ubuntu15.10","displayName":"Spark 1.6.0 (Hadoop 1)","packageLabel":"spark-image-10ef758029b8c7e19cd7f4fb52fff9180d75db92ca071bd94c47f3c1171a7cb5","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.x-ubuntu15.10-hadoop2","displayName":"Spark 1.6.x (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.0-ubuntu15.10-scala2.11","displayName":"Spark 2.0.0 (Scala 2.11)","packageLabel":"spark-image-b4ec141e751f201399f8358a82efee202560f7ed05e1a04a2ae8778f6324b909","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.1.0-db3-scala2.11","displayName":"Spark 2.1.0-db3 (Scala 2.11)","packageLabel":"spark-image-ccbc6b73f158e2001fc1fb8c827bfdde425d8bd6d65cb7b3269784c28bb72c16","upgradable":true,"deprecated":false,"customerVisible":true}],"enableClearStateAndRunAll":true,"enableRestrictedClusterCreation":true,"enableFeedback":true,"enableClusterAutoScaling":false,"enableUserVisibleDefaultTags":true,"defaultNumWorkers":0,"serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","enableNotebookRefresh":false,"accountsOwnerUrl":"https://accounts.cloud.databricks.com/registration.html#login","driverStdoutFilePrefix":"stdout","defaultNodeTypeToPricingUnitsMap":{"r3.2xlarge":2,"i3.4xlarge":6,"class-node":1,"m4.2xlarge":1.5,"r4.xlarge":1,"m4.4xlarge":3,"r4.16xlarge":16,"Standard_DS11":0.5,"p2.8xlarge":16,"m4.10xlarge":8,"r3.8xlarge":8,"r4.4xlarge":4,"dev-tier-node":1,"c3.8xlarge":4,"r3.4xlarge":4,"i2.4xlarge":6,"m4.xlarge":0.75,"r4.8xlarge":8,"r4.large":0.5,"Standard_DS12":1,"development-node":1,"i2.2xlarge":3,"g2.8xlarge":6,"i3.large":0.75,"memory-optimized":1,"m4.large":0.375,"p2.16xlarge":24,"i3.8xlarge":12,"i3.16xlarge":24,"Standard_DS12_v2":1,"Standard_DS13":2,"Standard_DS11_v2":0.5,"Standard_DS13_v2":2,"c3.2xlarge":1,"Standard_L4s":1.5,"c4.2xlarge":1,"i2.xlarge":1.5,"compute-optimized":1,"c4.4xlarge":2,"i3.2xlarge":3,"c3.4xlarge":2,"g2.2xlarge":1.5,"p2.xlarge":2,"m4.16xlarge":12,"c4.8xlarge":4,"i3.xlarge":1.5,"r3.xlarge":1,"r4.2xlarge":2,"i2.8xlarge":12},"enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"enableEBSVolumesUI":false,"sanitizeMarkdownHtml":true,"metastoreServiceRowLimit":1000000,"enableIPythonImportExport":true,"enableClusterTagsUIForJobs":true,"enableClusterTagsUI":false,"enableNotebookHistoryDiffing":true,"branch":"2.50","accountsLimit":3,"enableSparkEnvironmentVariables":true,"enableX509Authentication":false,"enableStructuredStreamingNbOptimizations":true,"enableNotebookGitBranching":true,"local":false,"enableNotebookLazyRenderWrapper":false,"enableClusterAutoScalingForJobs":false,"enableStrongPassword":false,"displayDefaultContainerMemoryGB":6,"enableNotebookCommandMode":true,"disableS3TableImport":false,"deploymentMode":"production","useSpotForWorkers":true,"preferStartTerminatedCluster":true,"enableNonPollingTableCall":true,"enableUserInviteWorkflow":true,"enableStaticNotebooks":true,"enableCssTransitions":true,"serverlessEnableElasticDisk":true,"minClusterTagKeyLength":1,"showHomepageFeaturedLinks":true,"pricingURL":"https://databricks.com/product/pricing","enableClusterAclsConfig":false,"useTempS3UrlForTableUpload":false,"notifyLastLogin":false,"enableSshKeyUIByTier":false,"enableCreateClusterOnAttach":true,"defaultAutomatedPricePerDBU":0.2,"enableNotebookGitVersioning":true,"files":"files/","feedbackEmail":"feedback@databricks.com","enableDriverLogsUI":true,"enableWorkspaceAclsConfig":false,"dropzoneMaxFileSize":2047,"enableNewClustersList":false,"enableNewDashboardViews":true,"driverLog4jFilePrefix":"log4j","enableSingleSignOn":true,"enableMavenLibraries":true,"displayRowLimit":1000,"deltaProcessingAsyncEnabled":true,"enableSparkEnvironmentVariablesUI":false,"defaultSparkVersion":{"key":"2.1.x-scala2.10","displayName":"Spark 2.1 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-74133df2c13950431298d1cab3e865c191d83ac33648a8590495c52fc644c654","upgradable":true,"deprecated":false,"customerVisible":true},"enableCustomSpotPricing":false,"enableMountAclsConfig":false,"defaultAutoterminationMin":180,"useDevTierHomePage":true,"enableClusterClone":true,"enableNotebookLineNumbers":true,"enablePublishHub":false,"notebookHubUrl":"http://hub.dev.databricks.com/","showSqlEndpoints":false,"enableNotebookDatasetInfoView":false,"enableClusterAclsByTier":false,"databricksDocsBaseUrl":"https://docs.databricks.com/","cloud":"AWS","disallowAddingAdmins":true,"enableSparkConfUI":true,"featureTier":"DEVELOPER_BASIC_TIER","mavenCentralSearchEndpoint":"http://search.maven.org/solrsearch/select","enableOrgSwitcherUI":true,"clustersLimit":1,"enableJdbcImport":true,"enableElasticDisk":false,"logfiles":"logfiles/","enableWebappSharding":true,"enableClusterDeltaUpdates":true,"enableSingleSignOnLogin":false,"ebsVolumeSizeLimitGB":{"GENERAL_PURPOSE_SSD":[100,4096],"THROUGHPUT_OPTIMIZED_HDD":[500,4096]},"enableMountAcls":false,"requireEmailUserName":true,"dbcFeedbackURL":"mailto:feedback@databricks.com","enableMountAclService":true,"serverlessClustersByDefault":false,"enableWorkspaceAcls":false,"maxClusterTagKeyLength":127,"gitHash":"2162bae813344ed1541d63a989142c9938e96057","showWorkspaceFeaturedLinks":true,"signupUrl":"https://databricks.com/try-databricks","allowFeedbackForumAccess":true,"enableImportFromUrl":true,"enableMiniClusters":true,"enableNewJobList":true,"enableNewTableUI":true,"enableDebugUI":false,"enableStreamingMetricsDashboard":true,"allowNonAdminUsers":true,"enableSingleSignOnByTier":false,"enableJobsRetryOnTimeout":true,"useStandardTierUpgradeTooltips":true,"staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/","enableSpotClusterType":true,"enableSparkPackages":true,"dynamicSparkVersions":true,"enableClusterTagsUIByTier":false,"enableNotebookHistoryUI":true,"enableClusterLoggingUI":true,"enableDatabaseDropdownInTableUI":true,"showDebugCounters":false,"enableInstanceProfilesUI":false,"enableFolderHtmlExport":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.databricks.com/_static/notebooks/gentle-introduction-to-apache-spark.html","displayName":"Introduction to Apache Spark on Databricks","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/databricks-for-data-scientists.html","displayName":"Databricks for Data Scientists","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/structured-streaming-python.html","displayName":"Introduction to Structured Streaming","icon":"img/home/Python_icon.svg"}],"enableClusterStart":false,"enableEBSVolumesUIByTier":false,"singleSignOnComingSoon":false,"removeSubCommandCodeWhenExport":true,"upgradeURL":"https://accounts.cloud.databricks.com/registration.html#login","maxAutoterminationMinutes":10000,"autoterminateClustersByDefault":true,"notebookLoadingBackground":"#fff","sshContainerForwardedPort":2200,"enableServerAutoComplete":true,"enableStaticHtmlImport":true,"enableInstanceProfilesByTier":false,"showForgotPasswordLink":true,"defaultMemoryPerContainerMB":6000,"enablePresenceUI":true,"minAutoterminationMinutes":10,"accounts":true,"useOnDemandClustersByDefault":true,"useFramedStaticNotebooks":false,"enableNewProgressReportUI":true,"enableAutoCreateUserUI":true,"defaultCoresPerContainer":4,"showTerminationReason":true,"enableNewClustersGet":true,"showPricePerDBU":false,"showSqlProxyUI":true,"enableNotebookErrorHighlighting":true};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":3287337392668921,"name":"02-SQLDataFramesPython","language":"python","commands":[{"version":"CommandV1","origId":3287337392668923,"guid":"1471c112-1461-44cb-98d1-fb26e1844c67","subtype":"command","commandType":"auto","position":0.125,"command":"%md ### ![Spark Logo](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark.png) + ![SF Open Data Logo](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/logo_sfopendata.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dc10992e-6f07-46f1-9e2f-62d76497f6c0"},{"version":"CommandV1","origId":3287337392668924,"guid":"59d6ca82-4257-45e6-9eb8-ea72b4fe1f72","subtype":"command","commandType":"auto","position":0.21875,"command":"%md Mount the data:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b379a781-c9b0-4c0f-914d-cc35cca40cec"},{"version":"CommandV1","origId":3287337392668925,"guid":"b33cd2f0-88ce-4036-ac97-80a843c70522","subtype":"command","commandType":"auto","position":0.2421875,"command":"ACCESSY_KEY_ID = \"AKIAJBRYNXGHORDHZB4A\"\nSECERET_ACCESS_KEY = \"a0BzE1bSegfydr3%2FGE3LSPM6uIV5A4hOUfpH8aFF\" \n\nmounts_list = [\n{'bucket':'databricks-corp-training/sf_open_data/', 'mount_folder':'/mnt/sf_open_data'}\n]","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498594206493,"submitTime":1498594206466,"finishTime":1498594206534,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f9e17e15-9332-492e-bf50-f791e8e33143"},{"version":"CommandV1","origId":3287337392668926,"guid":"591e4f9f-8ea0-4441-8f08-eb641995304b","subtype":"command","commandType":"auto","position":0.265625,"command":"for mount_point in mounts_list:\n  bucket = mount_point['bucket']\n  mount_folder = mount_point['mount_folder']\n  try:\n    dbutils.fs.ls(mount_folder)\n    dbutils.fs.unmount(mount_folder)\n  except:\n    pass\n  finally: #If MOUNT_FOLDER does not exist\n    dbutils.fs.mount(\"s3a://\"+ ACCESSY_KEY_ID + \":\" + SECERET_ACCESS_KEY + \"@\" + bucket,mount_folder)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">/mnt/sf_open_data has been unmounted.\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498594208245,"submitTime":1498594208236,"finishTime":1498594249559,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c587cdb7-dc72-4590-9aa6-a5ff0badf108"},{"version":"CommandV1","origId":3287337392668927,"guid":"ce0243a1-6af5-4ddb-be5f-f01f6ac74dc9","subtype":"command","commandType":"auto","position":0.3125,"command":"%md ## Exploring the City of San Francisco public data with Apache Spark 2.0","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"69039d3f-a114-486c-96d6-3cf7829ef4f3"},{"version":"CommandV1","origId":3287337392668929,"guid":"e7963de7-b5e7-4c1e-bf37-28d6d41b0dda","subtype":"command","commandType":"auto","position":0.40625,"command":"%md It was the 4th of July a couple of weeks ago, so SF residents enjoyed a fireworks show:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6da9ee8b-1146-4fcc-842c-212708ef6bbc"},{"version":"CommandV1","origId":3287337392668930,"guid":"75786608-084f-4999-8d25-15b0f947f316","subtype":"command","commandType":"auto","position":0.4296875,"command":"%md ![Fireworks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/fireworks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6c87cfb9-bad8-43c7-89e1-16d09f506ac8"},{"version":"CommandV1","origId":3287337392668931,"guid":"58f299ad-71af-4495-89bd-4c497c6a7907","subtype":"command","commandType":"auto","position":0.453125,"command":"%md How did the 4th of July holiday affect demand for Firefighters a year ago in SF districts?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"50f922d3-5802-4ef2-a83e-f1b58ab98c13"},{"version":"CommandV1","origId":3287337392668928,"guid":"1284e00b-fcc2-40ae-8ac3-f5289a5f54d1","subtype":"command","commandType":"auto","position":0.4765625,"command":"%md The SF OpenData project was launched in 2009 and contains hundreds of datasets from the city and county of San Francisco. Open government data has the potential to increase the quality of life for residents, create more efficient government services, better public decisions, and even new local businesses and services.\n\nIn our analysis of SF Fire Department calls, we will be seeking answers the following questions:\n\n1. **How many different types of calls were made to the Fire Department?**\n2. **How many incidents of each call type were there?**\n3. **How many incidents of each call type were there?**\n4. **How many service calls were logged in the past 7 days?**\n5. **Which neighborhood in SF generated the most calls last year?**\n6. **What was the primary non-medical reason most people called the fire department from the Tenderloin last year?**\n\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9646ffff-f7be-44fc-a4ec-6e967590fa85"},{"version":"CommandV1","origId":3287337392668932,"guid":"e5b3b63a-dceb-4fad-be66-56ee016c4db6","subtype":"command","commandType":"auto","position":0.4794921875,"command":"%md ## Introduction to Spark","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4c7c84e0-6d90-4188-9035-79791fd9ae23"},{"version":"CommandV1","origId":3287337392668935,"guid":"2ba5bd71-4ee6-4457-a0f5-32de9d799b92","subtype":"command","commandType":"auto","position":0.494140625,"command":"%md Spark is a unified processing engine that can analyze big data using SQL, machine learning, graph processing or real time stream analysis:\n\n![Spark Engines](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_4engines.png)\n\nWe will mostly focus on Spark SQL and DataFrames this evening.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6ac00e3b-df5a-4c3a-a967-79198cebdf78"},{"version":"CommandV1","origId":3287337392668936,"guid":"431d50c4-7b30-400e-bc61-00770ddbd78d","subtype":"command","commandType":"auto","position":0.49560546875,"command":"%md Spark can read from many different databases and file systems and run in various environments:\n\n![Spark Goal](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_goal.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ed4001e0-3031-42a7-be20-5eae02562aa4"},{"version":"CommandV1","origId":3287337392668937,"guid":"7337c2d5-795b-481d-8aed-3c67203d7515","subtype":"command","commandType":"auto","position":0.4970703125,"command":"%md Although Spark supports four languages (Scala, Java, Python, R), tonight we will use Python.\nBroadly speaking, there are **2 APIs** for interacting with Spark:\n- **DataFrames/SQL/Datasets:** general, higher level API for users of Spark\n- **RDD:** a lower level API for spark internals and advanced programming","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"612adee6-e2ba-4ae2-a5e7-0a6ab1bcd043"},{"version":"CommandV1","origId":3287337392668938,"guid":"99c061e7-6161-4a73-8c90-458567941a10","subtype":"command","commandType":"auto","position":0.497802734375,"command":"%md A Spark cluster is made of one Driver and many Executor JVMs (java virtual machines):","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2aec3e6b-bad3-4307-ade1-c441c4515b6c"},{"version":"CommandV1","origId":3287337392668939,"guid":"470c3d63-99b5-41df-af44-f94eec9d8380","subtype":"command","commandType":"auto","position":0.497894287109375,"command":"%md ![Spark Physical Cluster, slots](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_cluster_slots.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"be2f037a-9e3a-4041-b203-e93c8e651945"},{"version":"CommandV1","origId":3287337392668940,"guid":"0c307a4b-0ed4-40d3-9d5a-bf9dd0f25347","subtype":"command","commandType":"auto","position":0.49798583984375,"command":"%md The Driver sends Tasks to the empty slots on the Executors when work has to be done:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8a7f95a6-63c3-4cb2-90ac-9369794d942b"},{"version":"CommandV1","origId":3287337392668941,"guid":"798cd3cd-b6bf-483c-a5fd-c29ea95eb5ff","subtype":"command","commandType":"auto","position":0.4981689453125,"command":"%md ![Spark Physical Cluster, tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/spark_cluster_tasks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"52764a31-7194-4518-85e4-f6aa37d8c230"},{"version":"CommandV1","origId":3287337392668942,"guid":"f5949147-d3c3-4e83-9322-52dffebd0048","subtype":"command","commandType":"auto","position":0.49835205078125,"command":"%md In Databricks Community Edition, everyone gets a local mode cluster, where the Driver and Executor code run in the same JVM. Local mode clusters are typically used for prototyping and learning Spark:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1e3dbfbb-7e46-4d9f-8447-5867644480f9"},{"version":"CommandV1","origId":3287337392668943,"guid":"1959058d-98a2-41c7-ad9c-198e42dd5cc9","subtype":"command","commandType":"auto","position":0.498443603515625,"command":"%md ![Notebook + Micro Cluster](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/notebook_microcluster.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ab934705-eb02-4766-b221-04703242854c"},{"version":"CommandV1","origId":3287337392668944,"guid":"d4f4263e-7ec5-4a64-bf97-a619b1471331","subtype":"command","commandType":"auto","position":0.4984893798828125,"command":"%md ![Databricks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/databricks_about.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8f5141f5-808e-46fc-80ea-83eb67050de0"},{"version":"CommandV1","origId":3287337392668945,"guid":"8655253f-f36b-485f-b8aa-8ba71366af96","subtype":"command","commandType":"auto","position":0.49853515625,"command":"%md ## Introduction to Fire Department Calls for Service","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0796c68b-4df1-42a2-8134-8237ece70af2"},{"version":"CommandV1","origId":3287337392668946,"guid":"69c0ab0b-3f89-4783-b8bc-aedb49298584","subtype":"command","commandType":"auto","position":0.5,"command":"%md The latest July 6th, 2016 copy of the \"Fire Department Calls for Service\" data set has been uploaded to S3. You can see the data with the `%fs ls` command:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7cdbe31f-b6d2-4117-b21d-0daa2062af85"},{"version":"CommandV1","origId":3287337392668947,"guid":"787c02a9-d804-449a-ac05-5f580d44cbb9","subtype":"command","commandType":"auto","position":2.0,"command":"%fs ls /mnt/sf_open_data/fire_dept_calls_for_service/","commandVersion":0,"state":"finished","results":{"type":"table","data":[["dbfs:/mnt/sf_open_data/fire_dept_calls_for_service/Fire_Department_Calls_for_Service.csv","Fire_Department_Calls_for_Service.csv",1634673683]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"path","type":"\"string\"","metadata":"{}"},{"name":"name","type":"\"string\"","metadata":"{}"},{"name":"size","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600368815,"submitTime":1498600368794,"finishTime":1498600371904,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ff76d36f-2c08-4f73-a2fe-07f06d9421ca"},{"version":"CommandV1","origId":3287337392668948,"guid":"647c7653-8fac-4983-991a-0c7b7ccd25b8","subtype":"command","commandType":"auto","position":2.03125,"command":"%md Note, you can also access the 1.6 GB of data directly from sfgov.org via this link: https://data.sfgov.org/Public-Safety/Fire-Department-Calls-for-Service/nuek-vuh3","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"57067800-2edf-4bc7-88d8-14ce90646f7d"},{"version":"CommandV1","origId":3287337392668949,"guid":"3286d797-9ef5-47bc-808f-44cf12756aa3","subtype":"command","commandType":"auto","position":2.0625,"command":"%md The entry point into all functionality in Spark 2.x is the new SparkSession class, which we explored in our previous workshop: http://dbricks.co/ss_wkshp1","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d0ab8d66-36f2-4240-a909-564b88dbd85f"},{"version":"CommandV1","origId":3287337392668950,"guid":"2a21b794-ebd6-4780-b65c-e4164ec273c6","subtype":"command","commandType":"auto","position":2.125,"command":"spark","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">3</span><span class=\"ansired\">]: </span>&lt;pyspark.sql.session.SparkSession at 0x7f190d131450&gt;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;spark&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-1-9eae6893311e&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>spark<span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;spark&apos; is not defined\n</div>","workflows":[],"startTime":1498594258790,"submitTime":1498594258782,"finishTime":1498594258813,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e87c27c8-c946-4f2b-9804-03c55d4b388c"},{"version":"CommandV1","origId":3287337392668951,"guid":"d1b0170d-c7dd-4b37-8d0e-9ac43e42af03","subtype":"command","commandType":"auto","position":2.140625,"command":"%md Using the SparkSession, create a DataFrame from the CSV file by inferring the schema:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a77e4ef1-ed9b-4e67-98ca-8460994e316d"},{"version":"CommandV1","origId":3287337392668952,"guid":"524a2442-a1fe-48ad-a5e9-9098af0248d5","subtype":"command","commandType":"auto","position":2.14453125,"command":"fireServiceCallsDF = spark.read.csv('/mnt/sf_open_data/fire_dept_calls_for_service/Fire_Department_Calls_for_Service.csv', header=True, inferSchema=True)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600583011,"submitTime":1498600583004,"finishTime":1498600597194,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fb47172b-74cd-4b82-bfc9-6be9c9d42059"},{"version":"CommandV1","origId":3287337392668953,"guid":"ff9e7409-c97a-4701-9721-435289c4a692","subtype":"command","commandType":"auto","position":2.146484375,"command":"%md Notice that the above cell takes ~15 seconds to run because it is inferring the schema by sampling the file and reading through it.\n\nInferring the schema works for ad hoc analysis against smaller datasets. But when working on multi-TB+ data, it's better to provide an **explicit pre-defined schema manually**, so there's no inferring cost:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0874bd38-edc1-43b2-80b1-1c11bf6fc0c0"},{"version":"CommandV1","origId":3287337392668954,"guid":"599d70a8-2439-4d36-9ddf-00c4027dd4e7","subtype":"command","commandType":"auto","position":2.14892578125,"command":"from pyspark.sql.types import StructType, StructField, IntegerType, StringType, BooleanType","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600638666,"submitTime":1498600638659,"finishTime":1498600638690,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"69a4bcc5-f5a9-48ac-8db6-5cfa00695157"},{"version":"CommandV1","origId":3287337392668955,"guid":"e02b24a4-1963-410a-8344-34bdf7ca0fb9","subtype":"command","commandType":"auto","position":2.1494140625,"command":"# Note that we are removing all space characters from the col names to prevent errors when writing to Parquet later\n\nfireSchema = StructType([StructField('CallNumber', IntegerType(), True),\n                     StructField('UnitID', StringType(), True),\n                     StructField('IncidentNumber', IntegerType(), True),\n                     StructField('CallType', StringType(), True),                  \n                     StructField('CallDate', StringType(), True),       \n                     StructField('WatchDate', StringType(), True),       \n                     StructField('ReceivedDtTm', StringType(), True),       \n                     StructField('EntryDtTm', StringType(), True),       \n                     StructField('DispatchDtTm', StringType(), True),       \n                     StructField('ResponseDtTm', StringType(), True),       \n                     StructField('OnSceneDtTm', StringType(), True),       \n                     StructField('TransportDtTm', StringType(), True),                  \n                     StructField('HospitalDtTm', StringType(), True),       \n                     StructField('CallFinalDisposition', StringType(), True),       \n                     StructField('AvailableDtTm', StringType(), True),       \n                     StructField('Address', StringType(), True),       \n                     StructField('City', StringType(), True),       \n                     StructField('ZipcodeofIncident', IntegerType(), True),       \n                     StructField('Battalion', StringType(), True),                 \n                     StructField('StationArea', StringType(), True),       \n                     StructField('Box', StringType(), True),       \n                     StructField('OriginalPriority', StringType(), True),       \n                     StructField('Priority', StringType(), True),       \n                     StructField('FinalPriority', IntegerType(), True),       \n                     StructField('ALSUnit', BooleanType(), True),       \n                     StructField('CallTypeGroup', StringType(), True),\n                     StructField('NumberofAlarms', IntegerType(), True),\n                     StructField('UnitType', StringType(), True),\n                     StructField('Unitsequenceincalldispatch', IntegerType(), True),\n                     StructField('FirePreventionDistrict', StringType(), True),\n                     StructField('SupervisorDistrict', StringType(), True),\n                     StructField('NeighborhoodDistrict', StringType(), True),\n                     StructField('Location', StringType(), True),\n                     StructField('RowID', StringType(), True)])","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;Type&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-10-548879165276&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     16</span>                      StructField<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Address&apos;</span><span class=\"ansiyellow\">,</span> StringType<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     17</span>                      StructField<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;City&apos;</span><span class=\"ansiyellow\">,</span> StringType<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 18</span><span class=\"ansiyellow\">                      </span>StructField<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Zipcode of Incident&apos;</span><span class=\"ansiyellow\">,</span> Type<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     19</span>                      StructField<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Battalion&apos;</span><span class=\"ansiyellow\">,</span> Type<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     20</span>                      StructField<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Station Area&apos;</span><span class=\"ansiyellow\">,</span> Type<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;Type&apos; is not defined\n</div>","workflows":[],"startTime":1498600664026,"submitTime":1498600664017,"finishTime":1498600664103,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"375bb74d-5b41-490f-b4d8-8e2b3afab34f"},{"version":"CommandV1","origId":3287337392668956,"guid":"25c55901-d700-40a2-8431-3c6105896a65","subtype":"command","commandType":"auto","position":2.15087890625,"command":"#Notice that no job is run this time\n# Python is not typed language so Datasets don't exists. Instead, we always get back a DataFrame\nfireServiceCallsDF = spark.read.csv('/mnt/sf_open_data/fire_dept_calls_for_service/Fire_Department_Calls_for_Service.csv', header=True, schema=fireSchema)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600737050,"submitTime":1498600737043,"finishTime":1498600737223,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6e3093e6-46eb-46f8-9e28-c2a9f9c1d19f"},{"version":"CommandV1","origId":3287337392668957,"guid":"174a2414-fd9e-47b4-930b-4894d451323c","subtype":"command","commandType":"auto","position":2.15234375,"command":"%md Look at the first 5 records in the DataFrame:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"63954aa6-9518-480c-b2df-e6054f5b1db5"},{"version":"CommandV1","origId":3287337392668958,"guid":"dd45d5aa-2cfa-470b-9f01-777bfd0e5578","subtype":"command","commandType":"auto","position":2.1552734375,"command":"display(fireServiceCallsDF.limit(5))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[142480332,"B02",14086309,"Alarms","09/05/2014","09/04/2014","09/05/2014 03:15:13 AM","09/05/2014 03:17:26 AM","09/05/2014 03:18:18 AM","09/05/2014 03:20:30 AM","09/05/2014 03:24:11 AM","04/25/2016 01:15:16 PM","04/25/2016 01:15:16 PM","Fire","09/05/2014 03:33:20 AM","1600 Block of HAIGHT ST","San Francisco",94117,"B05","12","4525","3","3",3,true,"Alarm",1,"CHIEF",3,"5","5","Haight Ashbury","(37.7695711762103, -122.449920089485)","142480332-B02"],[153022542,"T02",15115908,"Structure Fire","10/29/2015","10/29/2015","10/29/2015 03:39:06 PM","10/29/2015 03:39:25 PM","10/29/2015 03:39:49 PM","10/29/2015 03:40:55 PM","10/29/2015 03:43:21 PM","04/25/2016 01:07:30 PM","04/25/2016 01:07:30 PM","Fire","10/29/2015 03:51:21 PM","BATTERY ST/VALLEJO ST","San Francisco",94111,"B01","13","1155","3","3",3,false,"Alarm",1,"TRUCK",4,"1","3","Financial District/South Beach","(37.7995314468258, -122.401240243673)","153022542-T02"],[143451112,"AM04",14122741,"Medical Incident","12/11/2014","12/11/2014","12/11/2014 09:02:07 AM","12/11/2014 09:03:01 AM","12/11/2014 09:03:11 AM","12/11/2014 09:06:19 AM","12/11/2014 09:20:16 AM","12/11/2014 09:20:26 AM","12/11/2014 09:43:41 AM","Code 2 Transport","12/11/2014 10:06:26 AM","300 Block of BUENA VISTA AVE","San Francisco",94117,"B05","21","5136","3","3",3,false,"Potentially Life-Threatening",1,"PRIVATE",1,"5","8","Castro/Upper Market","(37.7668035178194, -122.440704687809)","143451112-AM04"],[141660300,"E01",14057129,"Medical Incident","06/15/2014","06/14/2014","06/15/2014 02:04:57 AM","06/15/2014 02:06:42 AM","06/15/2014 02:10:01 AM","06/15/2014 02:12:55 AM","06/15/2014 02:24:55 AM","04/25/2016 01:16:45 PM","04/25/2016 01:16:45 PM","Code 2 Transport","06/15/2014 02:51:39 AM","0 Block of HALLAM ST","San Francisco",94103,"B03","1","2313","2","2",2,true,"Non Life-threatening",1,"ENGINE",2,"2","6","South of Market","(37.7756902570435, -122.408609057895)","141660300-E01"],[152633454,"E36",15100829,"Outside Fire","09/20/2015","09/20/2015","09/20/2015 08:15:00 PM","09/20/2015 08:15:53 PM","09/20/2015 08:16:17 PM","09/20/2015 08:18:07 PM","04/25/2016 01:08:14 PM","04/25/2016 01:08:14 PM","04/25/2016 01:08:14 PM","Fire","09/20/2015 08:22:11 PM","MARKET ST/VAN NESS AV","San Francisco",94103,"B02","36","3211","3","3",3,true,"Fire",1,"ENGINE",1,"2","6","Mission","(37.7751470741622, -122.419255607214)","152633454-E36"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"CallNumber","type":"\"integer\"","metadata":"{}"},{"name":"UnitID","type":"\"string\"","metadata":"{}"},{"name":"IncidentNumber","type":"\"integer\"","metadata":"{}"},{"name":"CallType","type":"\"string\"","metadata":"{}"},{"name":"CallDate","type":"\"string\"","metadata":"{}"},{"name":"WatchDate","type":"\"string\"","metadata":"{}"},{"name":"ReceivedDtTm","type":"\"string\"","metadata":"{}"},{"name":"EntryDtTm","type":"\"string\"","metadata":"{}"},{"name":"DispatchDtTm","type":"\"string\"","metadata":"{}"},{"name":"ResponseDtTm","type":"\"string\"","metadata":"{}"},{"name":"OnSceneDtTm","type":"\"string\"","metadata":"{}"},{"name":"TransportDtTm","type":"\"string\"","metadata":"{}"},{"name":"HospitalDtTm","type":"\"string\"","metadata":"{}"},{"name":"CallFinalDisposition","type":"\"string\"","metadata":"{}"},{"name":"AvailableDtTm","type":"\"string\"","metadata":"{}"},{"name":"Address","type":"\"string\"","metadata":"{}"},{"name":"City","type":"\"string\"","metadata":"{}"},{"name":"ZipcodeofIncident","type":"\"integer\"","metadata":"{}"},{"name":"Battalion","type":"\"string\"","metadata":"{}"},{"name":"StationArea","type":"\"string\"","metadata":"{}"},{"name":"Box","type":"\"string\"","metadata":"{}"},{"name":"OriginalPriority","type":"\"string\"","metadata":"{}"},{"name":"Priority","type":"\"string\"","metadata":"{}"},{"name":"FinalPriority","type":"\"integer\"","metadata":"{}"},{"name":"ALSUnit","type":"\"boolean\"","metadata":"{}"},{"name":"CallTypeGroup","type":"\"string\"","metadata":"{}"},{"name":"NumberofAlarms","type":"\"integer\"","metadata":"{}"},{"name":"UnitType","type":"\"string\"","metadata":"{}"},{"name":"Unitsequenceincalldispatch","type":"\"integer\"","metadata":"{}"},{"name":"FirePreventionDistrict","type":"\"string\"","metadata":"{}"},{"name":"SupervisorDistrict","type":"\"string\"","metadata":"{}"},{"name":"NeighborhoodDistrict","type":"\"string\"","metadata":"{}"},{"name":"Location","type":"\"string\"","metadata":"{}"},{"name":"RowID","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600768011,"submitTime":1498600768003,"finishTime":1498600769309,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"2992.011364","height":"285.011364","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b35e223-1fa2-40bd-8dfb-3c6d03402cdf"},{"version":"CommandV1","origId":7685207635896,"guid":"832cdf88-79c3-4c69-88f8-60f12b890f5c","subtype":"command","commandType":"auto","position":2.15673828125,"command":"%md Let's examine the schema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7ff8695a-f8be-441c-8e87-31b944b63d4a"},{"version":"CommandV1","origId":7685207635897,"guid":"d2453498-e425-4743-9a58-cd4d59cad85d","subtype":"command","commandType":"auto","position":2.157470703125,"command":"fireServiceCallsDF.printSchema()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- CallNumber: integer (nullable = true)\n |-- UnitID: string (nullable = true)\n |-- IncidentNumber: integer (nullable = true)\n |-- CallType: string (nullable = true)\n |-- CallDate: string (nullable = true)\n |-- WatchDate: string (nullable = true)\n |-- ReceivedDtTm: string (nullable = true)\n |-- EntryDtTm: string (nullable = true)\n |-- DispatchDtTm: string (nullable = true)\n |-- ResponseDtTm: string (nullable = true)\n |-- OnSceneDtTm: string (nullable = true)\n |-- TransportDtTm: string (nullable = true)\n |-- HospitalDtTm: string (nullable = true)\n |-- CallFinalDisposition: string (nullable = true)\n |-- AvailableDtTm: string (nullable = true)\n |-- Address: string (nullable = true)\n |-- City: string (nullable = true)\n |-- ZipcodeofIncident: integer (nullable = true)\n |-- Battalion: string (nullable = true)\n |-- StationArea: string (nullable = true)\n |-- Box: string (nullable = true)\n |-- OriginalPriority: string (nullable = true)\n |-- Priority: string (nullable = true)\n |-- FinalPriority: integer (nullable = true)\n |-- ALSUnit: boolean (nullable = true)\n |-- CallTypeGroup: string (nullable = true)\n |-- NumberofAlarms: integer (nullable = true)\n |-- UnitType: string (nullable = true)\n |-- Unitsequenceincalldispatch: integer (nullable = true)\n |-- FirePreventionDistrict: string (nullable = true)\n |-- SupervisorDistrict: string (nullable = true)\n |-- NeighborhoodDistrict: string (nullable = true)\n |-- Location: string (nullable = true)\n |-- RowID: string (nullable = true)\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600936694,"submitTime":1498600936671,"finishTime":1498600936734,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"795c3791-38d2-4bd6-8f74-f01b8484fd6b"},{"version":"CommandV1","origId":3287337392668959,"guid":"a6e51478-4bd4-48ea-9ee2-370eccadcfa0","subtype":"command","commandType":"auto","position":2.158203125,"command":"%md Print just the column names in the DataFrame:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ee040530-be50-430b-9b73-bda631a30ec0"},{"version":"CommandV1","origId":3287337392668960,"guid":"774276ac-ee16-49e9-bddf-a38e59bb5b65","subtype":"command","commandType":"auto","position":2.1591796875,"command":"fireServiceCallsDF.columns","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">11</span><span class=\"ansired\">]: </span>\n[&apos;CallNumber&apos;,\n &apos;UnitID&apos;,\n &apos;IncidentNumber&apos;,\n &apos;CallType&apos;,\n &apos;CallDate&apos;,\n &apos;WatchDate&apos;,\n &apos;ReceivedDtTm&apos;,\n &apos;EntryDtTm&apos;,\n &apos;DispatchDtTm&apos;,\n &apos;ResponseDtTm&apos;,\n &apos;OnSceneDtTm&apos;,\n &apos;TransportDtTm&apos;,\n &apos;HospitalDtTm&apos;,\n &apos;CallFinalDisposition&apos;,\n &apos;AvailableDtTm&apos;,\n &apos;Address&apos;,\n &apos;City&apos;,\n &apos;ZipcodeofIncident&apos;,\n &apos;Battalion&apos;,\n &apos;StationArea&apos;,\n &apos;Box&apos;,\n &apos;OriginalPriority&apos;,\n &apos;Priority&apos;,\n &apos;FinalPriority&apos;,\n &apos;ALSUnit&apos;,\n &apos;CallTypeGroup&apos;,\n &apos;NumberofAlarms&apos;,\n &apos;UnitType&apos;,\n &apos;Unitsequenceincalldispatch&apos;,\n &apos;FirePreventionDistrict&apos;,\n &apos;SupervisorDistrict&apos;,\n &apos;NeighborhoodDistrict&apos;,\n &apos;Location&apos;,\n &apos;RowID&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498600946771,"submitTime":1498600946763,"finishTime":1498600946811,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"951fd570-9a36-43db-8993-71c288cac28a"},{"version":"CommandV1","origId":3287337392668961,"guid":"7983912c-488f-4d36-8fa3-b05de0d5d2cc","subtype":"command","commandType":"auto","position":2.16015625,"command":"%md Count how many rows total there are in DataFrame (and see how long it takes to do a full scan from remote disk/S3):","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e0f39709-c50a-4b28-bedc-056bfc8b75b1"},{"version":"CommandV1","origId":3287337392668962,"guid":"bb29b4e9-1149-43f6-9e14-2036e44f4a68","subtype":"command","commandType":"auto","position":2.3125,"command":"fireServiceCallsDF.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">12</span><span class=\"ansired\">]: </span>4091248\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-6-84c0bc809559&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceCallsDF<span class=\"ansiyellow\">.</span>count<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsDF&apos; is not defined\n</div>","workflows":[],"startTime":1498600973651,"submitTime":1498600973644,"finishTime":1498600986747,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3d8d99ba-348f-4580-959f-b18da89e4440"},{"version":"CommandV1","origId":3287337392668963,"guid":"8d4eaab4-74b8-4a59-95fa-e3a6bca3a512","subtype":"command","commandType":"auto","position":2.375,"command":"%md There are over 4 million rows in the DataFrame and it takes ~14 seconds to do a full read of it.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8769640e-794d-4e6f-a7d5-4c60e613695d"},{"version":"CommandV1","origId":3287337392668964,"guid":"bce14bba-35e3-4ed0-a7d7-4d87fa44060f","subtype":"command","commandType":"auto","position":2.4375,"command":"%md Open the Apache Spark 2.0 release documentation in new tabs, so you can easily reference the API guide:\n\n1) Spark 2.0 docs: http://spark.apache.org/docs/latest/api/python/index.html\n\n2) DataFrame user documentation: http://spark.apache.org/docs/latest/sql-programming-guide.html\n\n3) PySpark API 2.0 docs: http://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.DataFrame","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"974b95bb-a6fb-4e0a-9286-41ea6566e0a7"},{"version":"CommandV1","origId":3287337392668965,"guid":"71769cbf-027b-4392-bfc7-284fb4a4ea1f","subtype":"command","commandType":"auto","position":2.828125,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **Analysis with PySpark DataFrames API**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7a5f9239-cf57-4062-b153-35dc631b04fb"},{"version":"CommandV1","origId":3287337392668966,"guid":"8e9fff8f-eeb2-44a2-b7c0-919327c7f301","subtype":"command","commandType":"auto","position":2.876953125,"command":"%md ####![Spark Operations](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/spark_ta.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ba9e9092-4055-4181-98d9-303271688e1c"},{"version":"CommandV1","origId":3287337392668967,"guid":"de51addb-0979-4780-8bb0-94e50ea7b1c5","subtype":"command","commandType":"auto","position":2.9013671875,"command":"%md DataFrames support two types of operations: *transformations* and *actions*.\n\nTransformations, like `select()` or `filter()` create a new DataFrame from an existing one.\n\nActions, like `show()` or `count()`, return a value with results to the user. Other actions like `save()` write the DataFrame to distributed storage (like S3 or HDFS).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"39efa428-156a-4c2c-8100-3c62abbedea4"},{"version":"CommandV1","origId":3287337392668968,"guid":"2c242c87-3ae3-4873-8de8-de85a45d6e30","subtype":"command","commandType":"auto","position":2.91357421875,"command":"%md ####![Spark T/A](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pagecounts/trans_and_actions.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"92de560d-4634-4889-8fea-cd092b819396"},{"version":"CommandV1","origId":3287337392668969,"guid":"adb0d7d8-5777-46f8-b1ec-84fb15d4f24c","subtype":"command","commandType":"auto","position":2.919677734375,"command":"%md Transformations contribute to a query plan,  but  nothing is executed until an action is called.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8ad369f3-5621-4970-b23f-9e94c17ec507"},{"version":"CommandV1","origId":3287337392668970,"guid":"f7665083-1465-4e99-8450-84f91b176fcc","subtype":"command","commandType":"auto","position":2.92578125,"command":"%md **Q-1) How many different types of calls were made to the Fire Department?**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a55369d4-6827-4728-a267-7d6833718a34"},{"version":"CommandV1","origId":3287337392668971,"guid":"a2b67077-d32e-4a2a-935e-1ff671ebaa1b","subtype":"command","commandType":"auto","position":2.974609375,"command":"# Use the .select() transformation to yank out just the 'Call Type' column, then call the show action\n# show is OSS version of display(), which exists only in the Databricks notebooks. show() gives you the look and feel of REPL,\n# the shell on the commandline for pyspark\n# Notice the syntax: we reference the column by name\nfireServiceCallsDF.select('CallType').show(5)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+----------------+\n|        CallType|\n+----------------+\n|          Alarms|\n|  Structure Fire|\n|Medical Incident|\n|Medical Incident|\n|    Outside Fire|\n+----------------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498601335680,"submitTime":1498601335672,"finishTime":1498601335964,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ca61c5fe-47a1-4e68-b51d-1ca10db3fc00"},{"version":"CommandV1","origId":3287337392668972,"guid":"5cf97174-a8a1-4abe-83ed-00a1f82c40f4","subtype":"command","commandType":"auto","position":2.9990234375,"command":"# Add the .distinct() transformation to keep only distinct rows\n# The False below expands the ASCII column width to fit the full text in the output\n\nfireServiceCallsDF.select('CallType').distinct().show(35, False)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+--------------------------------------------+\n|CallType                                    |\n+--------------------------------------------+\n|Elevator / Escalator Rescue                 |\n|Marine Fire                                 |\n|Aircraft Emergency                          |\n|Confined Space / Structure Collapse         |\n|Administrative                              |\n|Alarms                                      |\n|Odor (Strange / Unknown)                    |\n|Lightning Strike (Investigation)            |\n|null                                        |\n|Citizen Assist / Service Call               |\n|HazMat                                      |\n|Watercraft in Distress                      |\n|Explosion                                   |\n|Oil Spill                                   |\n|Vehicle Fire                                |\n|Suspicious Package                          |\n|Train / Rail Fire                           |\n|Extrication / Entrapped (Machinery, Vehicle)|\n|Other                                       |\n|Transfer                                    |\n|Outside Fire                                |\n|Traffic Collision                           |\n|Assist Police                               |\n|Gas Leak (Natural and LP Gases)             |\n|Water Rescue                                |\n|Electrical Hazard                           |\n|High Angle Rescue                           |\n|Structure Fire                              |\n|Industrial Accidents                        |\n|Medical Incident                            |\n|Mutual Aid / Assist Outside Agency          |\n|Fuel Spill                                  |\n|Smoke Investigation (Outside)               |\n|Train / Rail Incident                       |\n+--------------------------------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsDF2&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-14-078046655fbc&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansired\"># Add the .distinct() transformation to keep only distinct rows</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>fireServiceCallsDF2<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Type&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>distinct<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">35</span><span class=\"ansiyellow\">,</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsDF2&apos; is not defined\n</div>","workflows":[],"startTime":1498601442622,"submitTime":1498601442613,"finishTime":1498601456340,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"408189d8-b6ca-4bb8-b1e1-d8439d19f92c"},{"version":"CommandV1","origId":3287337392668973,"guid":"3d49e138-5051-4974-bac5-a9eadfa270f6","subtype":"command","commandType":"auto","position":3.005126953125,"command":"%md **Q-2) How many incidents of each call type were there?**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9f57931a-8628-40ed-9086-f6cb9631f056"},{"version":"CommandV1","origId":3287337392668974,"guid":"e29465d8-d167-444d-83be-fe8409f4a476","subtype":"command","commandType":"auto","position":3.01885986328125,"command":"#Note that .count() is actually a transformation here\n\ndisplay(fireServiceCallsDF.select('CallType').groupBy('CallType').count().orderBy(\"count\", ascending=False))","commandVersion":0,"state":"finished","results":{"type":"table","data":[["Medical Incident",2590898],["Structure Fire",560055],["Alarms",432235],["Traffic Collision",158525],["Other",64156],["Citizen Assist / Service Call",62031],["Outside Fire",46273],["Administrative",30129],[null,26961],["Vehicle Fire",20001],["Water Rescue",18015],["Gas Leak (Natural and LP Gases)",14351],["Odor (Strange / Unknown)",11863],["Electrical Hazard",11017],["Elevator / Escalator Rescue",10296],["Smoke Investigation (Outside)",8776],["Fuel Spill",4860],["Transfer",4200],["HazMat",3525],["Industrial Accidents",2725],["Explosion",2392],["Aircraft Emergency",1495],["Assist Police",1156],["Train / Rail Incident",1056],["High Angle Rescue",1002],["Watercraft in Distress",852],["Extrication / Entrapped (Machinery, Vehicle)",572],["Oil Spill",507],["Marine Fire",356],["Mutual Aid / Assist Outside Agency",340],["Confined Space / Structure Collapse",335],["Suspicious Package",277],["Train / Rail Fire",10],["Lightning Strike (Investigation)",6]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"CallType","type":"\"string\"","metadata":"{}"},{"name":"count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498601590316,"submitTime":1498601590308,"finishTime":1498601613871,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"82e8dc31-7d6c-4542-9507-57805b333b02"},{"version":"CommandV1","origId":3287337392668975,"guid":"4b3342f8-f2c9-4a17-a4dd-c6137577ca01","subtype":"command","commandType":"auto","position":3.021148681640625,"command":"%md Seems like the SF Fire department is called for _medical incidents_ far more than any other type. Note that the above command took about 14 seconds to execute. In an upcoming section, we'll cache the data into memory for up to 100x speed increases.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bba5d0cd-c67e-4e6b-a974-084c90b21c72"},{"version":"CommandV1","origId":3287337392668976,"guid":"2566f002-0512-4b85-9474-274ae38ffaf2","subtype":"command","commandType":"auto","position":3.0234375,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** Doing ETL and Date/Time Analysis**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4960d90b-1022-4857-ab2c-d8f2364e27d1"},{"version":"CommandV1","origId":3287337392668977,"guid":"927b3234-bccf-4e5f-a215-47ba001a38ca","subtype":"command","commandType":"auto","position":3.12109375,"command":"%md **Q-3) How many years of Fire Service Calls is in the data file?**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"985d9709-2535-4555-a04c-c7480f4fa8e0"},{"version":"CommandV1","origId":3287337392668978,"guid":"93ad7420-96c0-4cfb-bb0f-6f9c6c752736","subtype":"command","commandType":"auto","position":3.169921875,"command":"%md Notice that the date or time columns are currently being interpreted as strings, rather than date or time objects:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a6232769-d65b-424c-82cf-229cdc71d679"},{"version":"CommandV1","origId":3287337392668979,"guid":"46f10864-fb1b-4435-938a-a552b0d547ab","subtype":"command","commandType":"auto","position":3.21875,"command":"fireServiceCallsDF.printSchema()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- CallNumber: integer (nullable = true)\n |-- UnitID: string (nullable = true)\n |-- IncidentNumber: integer (nullable = true)\n |-- CallType: string (nullable = true)\n |-- CallDate: string (nullable = true)\n |-- WatchDate: string (nullable = true)\n |-- ReceivedDtTm: string (nullable = true)\n |-- EntryDtTm: string (nullable = true)\n |-- DispatchDtTm: string (nullable = true)\n |-- ResponseDtTm: string (nullable = true)\n |-- OnSceneDtTm: string (nullable = true)\n |-- TransportDtTm: string (nullable = true)\n |-- HospitalDtTm: string (nullable = true)\n |-- CallFinalDisposition: string (nullable = true)\n |-- AvailableDtTm: string (nullable = true)\n |-- Address: string (nullable = true)\n |-- City: string (nullable = true)\n |-- ZipcodeofIncident: integer (nullable = true)\n |-- Battalion: string (nullable = true)\n |-- StationArea: string (nullable = true)\n |-- Box: string (nullable = true)\n |-- OriginalPriority: string (nullable = true)\n |-- Priority: string (nullable = true)\n |-- FinalPriority: integer (nullable = true)\n |-- ALSUnit: boolean (nullable = true)\n |-- CallTypeGroup: string (nullable = true)\n |-- NumberofAlarms: integer (nullable = true)\n |-- UnitType: string (nullable = true)\n |-- Unitsequenceincalldispatch: integer (nullable = true)\n |-- FirePreventionDistrict: string (nullable = true)\n |-- SupervisorDistrict: string (nullable = true)\n |-- NeighborhoodDistrict: string (nullable = true)\n |-- Location: string (nullable = true)\n |-- RowID: string (nullable = true)\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-10-a194cdab6554&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceCallsDF<span class=\"ansiyellow\">.</span>printSchema<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsDF&apos; is not defined\n</div>","workflows":[],"startTime":1467847696836,"submitTime":1467847652082,"finishTime":1467847696875,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"153ebd2d-559d-4aa9-a21d-621eb2f68108"},{"version":"CommandV1","origId":3287337392668980,"guid":"7fe6a2f1-3264-46b5-864f-92378161d5fe","subtype":"command","commandType":"auto","position":3.34375,"command":"%md Let's use the unix_timestamp() function to convert the string into a timestamp:\n\nhttp://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.functions.from_unixtime","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"49794378-2a1f-4d18-ae79-d0d4df3adb38"},{"version":"CommandV1","origId":3287337392668981,"guid":"24255501-842c-4886-b525-4ccc5b117cb3","subtype":"command","commandType":"auto","position":3.34765625,"command":"from pyspark.sql.functions import *","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498602073506,"submitTime":1498602073498,"finishTime":1498602073546,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e804b50e-0dc4-4b75-9277-cca41dbeb78e"},{"version":"CommandV1","origId":3287337392668982,"guid":"e782c0d1-a1d2-405a-b3c7-1a7b6c522395","subtype":"command","commandType":"auto","position":3.46875,"command":"# Note that PySpark uses the Java Simple Date Format patterns\n\nfrom_pattern1 = 'MM/dd/yyyy'\nto_pattern1 = 'yyyy-MM-dd'\n\nfrom_pattern2 = 'MM/dd/yyyy hh:mm:ss aa'\nto_pattern2 = 'MM/dd/yyyy hh:mm:ss aa'\n\n\nfireServiceCallsTsDF = fireServiceCallsDF \\\n  .withColumn('CallDateTS', unix_timestamp(fireServiceCallsDF['CallDate'], from_pattern1).cast(\"timestamp\")) \\\n  .drop('CallDate') \\\n  .withColumn('WatchDateTS', unix_timestamp(fireServiceCallsDF['WatchDate'], from_pattern1).cast(\"timestamp\")) \\\n  .drop('WatchDate') \\\n  .withColumn('ReceivedDtTmTS', unix_timestamp(fireServiceCallsDF['ReceivedDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('ReceivedDtTm') \\\n  .withColumn('EntryDtTmTS', unix_timestamp(fireServiceCallsDF['EntryDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('EntryDtTm') \\\n  .withColumn('DispatchDtTmTS', unix_timestamp(fireServiceCallsDF['DispatchDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('DispatchDtTm') \\\n  .withColumn('ResponseDtTmTS', unix_timestamp(fireServiceCallsDF['ResponseDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('ResponseDtTm') \\\n  .withColumn('OnSceneDtTmTS', unix_timestamp(fireServiceCallsDF['OnSceneDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('OnSceneDtTm') \\\n  .withColumn('TransportDtTmTS', unix_timestamp(fireServiceCallsDF['TransportDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('TransportDtTm') \\\n  .withColumn('HospitalDtTmTS', unix_timestamp(fireServiceCallsDF['HospitalDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('HospitalDtTm') \\\n  .withColumn('AvailableDtTmTS', unix_timestamp(fireServiceCallsDF['AvailableDtTm'], from_pattern2).cast(\"timestamp\")) \\\n  .drop('AvailableDtTm')  ","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;unix_timestamp&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-17-cde731052a7c&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      8</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      9</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 10</span><span class=\"ansiyellow\"> </span>fireServiceCallsTsDF <span class=\"ansiyellow\">=</span> fireServiceCallsDF   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;CallDateTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;CallDate&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern1<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;CallDate&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;WatchDateTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;WatchDate&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern1<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;WatchDate&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;ReceivedDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;ReceivedDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;ReceivedDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;EntryDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;EntryDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;EntryDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;DispatchDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;DispatchDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;DispatchDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;ResponseDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;ResponseDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;ResponseDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;OnSceneDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;OnSceneDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;OnSceneDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;TransportDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;TransportDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;TransportDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;HospitalDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;HospitalDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;HospitalDtTm&apos;</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>withColumn<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;AvailableDtTmTS&apos;</span><span class=\"ansiyellow\">,</span> unix_timestamp<span class=\"ansiyellow\">(</span>fireServiceCallsDF<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;AvailableDtTm&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> from_pattern2<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cast<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;timestamp&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span>   <span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;AvailableDtTm&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;unix_timestamp&apos; is not defined</div>","workflows":[],"startTime":1498602078146,"submitTime":1498602078136,"finishTime":1498602078471,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ec3f3c0b-8dfe-4f88-8b40-8edf6e5037e8"},{"version":"CommandV1","origId":3287337392668983,"guid":"eb1f4aba-1bec-407f-bbfc-8ebc6feb2cda","subtype":"command","commandType":"auto","position":3.5,"command":"fireServiceCallsTsDF.printSchema()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- CallNumber: integer (nullable = true)\n |-- UnitID: string (nullable = true)\n |-- IncidentNumber: integer (nullable = true)\n |-- CallType: string (nullable = true)\n |-- CallFinalDisposition: string (nullable = true)\n |-- Address: string (nullable = true)\n |-- City: string (nullable = true)\n |-- ZipcodeofIncident: integer (nullable = true)\n |-- Battalion: string (nullable = true)\n |-- StationArea: string (nullable = true)\n |-- Box: string (nullable = true)\n |-- OriginalPriority: string (nullable = true)\n |-- Priority: string (nullable = true)\n |-- FinalPriority: integer (nullable = true)\n |-- ALSUnit: boolean (nullable = true)\n |-- CallTypeGroup: string (nullable = true)\n |-- NumberofAlarms: integer (nullable = true)\n |-- UnitType: string (nullable = true)\n |-- Unitsequenceincalldispatch: integer (nullable = true)\n |-- FirePreventionDistrict: string (nullable = true)\n |-- SupervisorDistrict: string (nullable = true)\n |-- NeighborhoodDistrict: string (nullable = true)\n |-- Location: string (nullable = true)\n |-- RowID: string (nullable = true)\n |-- CallDateTS: timestamp (nullable = true)\n |-- WatchDateTS: timestamp (nullable = true)\n |-- ReceivedDtTmTS: timestamp (nullable = true)\n |-- EntryDtTmTS: timestamp (nullable = true)\n |-- DispatchDtTmTS: timestamp (nullable = true)\n |-- ResponseDtTmTS: timestamp (nullable = true)\n |-- OnSceneDtTmTS: timestamp (nullable = true)\n |-- TransportDtTmTS: timestamp (nullable = true)\n |-- HospitalDtTmTS: timestamp (nullable = true)\n |-- AvailableDtTmTS: timestamp (nullable = true)\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498602094238,"submitTime":1498602094230,"finishTime":1498602094261,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4fc3643f-c5c2-418b-9492-23eb43e88c1f"},{"version":"CommandV1","origId":3287337392668984,"guid":"8863524f-a89b-41fb-a25a-25920f6f7c6c","subtype":"command","commandType":"auto","position":3.5078125,"command":"%md Notice that the formatting of the timestamps is now different:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8d425bca-7506-4237-ad82-d0288928a722"},{"version":"CommandV1","origId":3287337392668985,"guid":"bff7af2d-f6aa-4b26-b176-8f25321e2865","subtype":"command","commandType":"auto","position":3.515625,"command":"display(fireServiceCallsTsDF.limit(5))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[142480332,"B02",14086309,"Alarms","Fire","1600 Block of HAIGHT ST","San Francisco",94117,"B05","12","4525","3","3",3,true,"Alarm",1,"CHIEF",3,"5","5","Haight Ashbury","(37.7695711762103, -122.449920089485)","142480332-B02","2014-09-05T00:00:00.000+0000","2014-09-04T00:00:00.000+0000","2014-09-05T03:15:13.000+0000","2014-09-05T03:17:26.000+0000","2014-09-05T03:18:18.000+0000","2014-09-05T03:20:30.000+0000","2014-09-05T03:24:11.000+0000","2016-04-25T13:15:16.000+0000","2016-04-25T13:15:16.000+0000","2014-09-05T03:33:20.000+0000"],[153022542,"T02",15115908,"Structure Fire","Fire","BATTERY ST/VALLEJO ST","San Francisco",94111,"B01","13","1155","3","3",3,false,"Alarm",1,"TRUCK",4,"1","3","Financial District/South Beach","(37.7995314468258, -122.401240243673)","153022542-T02","2015-10-29T00:00:00.000+0000","2015-10-29T00:00:00.000+0000","2015-10-29T15:39:06.000+0000","2015-10-29T15:39:25.000+0000","2015-10-29T15:39:49.000+0000","2015-10-29T15:40:55.000+0000","2015-10-29T15:43:21.000+0000","2016-04-25T13:07:30.000+0000","2016-04-25T13:07:30.000+0000","2015-10-29T15:51:21.000+0000"],[143451112,"AM04",14122741,"Medical Incident","Code 2 Transport","300 Block of BUENA VISTA AVE","San Francisco",94117,"B05","21","5136","3","3",3,false,"Potentially Life-Threatening",1,"PRIVATE",1,"5","8","Castro/Upper Market","(37.7668035178194, -122.440704687809)","143451112-AM04","2014-12-11T00:00:00.000+0000","2014-12-11T00:00:00.000+0000","2014-12-11T09:02:07.000+0000","2014-12-11T09:03:01.000+0000","2014-12-11T09:03:11.000+0000","2014-12-11T09:06:19.000+0000","2014-12-11T09:20:16.000+0000","2014-12-11T09:20:26.000+0000","2014-12-11T09:43:41.000+0000","2014-12-11T10:06:26.000+0000"],[141660300,"E01",14057129,"Medical Incident","Code 2 Transport","0 Block of HALLAM ST","San Francisco",94103,"B03","1","2313","2","2",2,true,"Non Life-threatening",1,"ENGINE",2,"2","6","South of Market","(37.7756902570435, -122.408609057895)","141660300-E01","2014-06-15T00:00:00.000+0000","2014-06-14T00:00:00.000+0000","2014-06-15T02:04:57.000+0000","2014-06-15T02:06:42.000+0000","2014-06-15T02:10:01.000+0000","2014-06-15T02:12:55.000+0000","2014-06-15T02:24:55.000+0000","2016-04-25T13:16:45.000+0000","2016-04-25T13:16:45.000+0000","2014-06-15T02:51:39.000+0000"],[152633454,"E36",15100829,"Outside Fire","Fire","MARKET ST/VAN NESS AV","San Francisco",94103,"B02","36","3211","3","3",3,true,"Fire",1,"ENGINE",1,"2","6","Mission","(37.7751470741622, -122.419255607214)","152633454-E36","2015-09-20T00:00:00.000+0000","2015-09-20T00:00:00.000+0000","2015-09-20T20:15:00.000+0000","2015-09-20T20:15:53.000+0000","2015-09-20T20:16:17.000+0000","2015-09-20T20:18:07.000+0000","2016-04-25T13:08:14.000+0000","2016-04-25T13:08:14.000+0000","2016-04-25T13:08:14.000+0000","2015-09-20T20:22:11.000+0000"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"CallNumber","type":"\"integer\"","metadata":"{}"},{"name":"UnitID","type":"\"string\"","metadata":"{}"},{"name":"IncidentNumber","type":"\"integer\"","metadata":"{}"},{"name":"CallType","type":"\"string\"","metadata":"{}"},{"name":"CallFinalDisposition","type":"\"string\"","metadata":"{}"},{"name":"Address","type":"\"string\"","metadata":"{}"},{"name":"City","type":"\"string\"","metadata":"{}"},{"name":"ZipcodeofIncident","type":"\"integer\"","metadata":"{}"},{"name":"Battalion","type":"\"string\"","metadata":"{}"},{"name":"StationArea","type":"\"string\"","metadata":"{}"},{"name":"Box","type":"\"string\"","metadata":"{}"},{"name":"OriginalPriority","type":"\"string\"","metadata":"{}"},{"name":"Priority","type":"\"string\"","metadata":"{}"},{"name":"FinalPriority","type":"\"integer\"","metadata":"{}"},{"name":"ALSUnit","type":"\"boolean\"","metadata":"{}"},{"name":"CallTypeGroup","type":"\"string\"","metadata":"{}"},{"name":"NumberofAlarms","type":"\"integer\"","metadata":"{}"},{"name":"UnitType","type":"\"string\"","metadata":"{}"},{"name":"Unitsequenceincalldispatch","type":"\"integer\"","metadata":"{}"},{"name":"FirePreventionDistrict","type":"\"string\"","metadata":"{}"},{"name":"SupervisorDistrict","type":"\"string\"","metadata":"{}"},{"name":"NeighborhoodDistrict","type":"\"string\"","metadata":"{}"},{"name":"Location","type":"\"string\"","metadata":"{}"},{"name":"RowID","type":"\"string\"","metadata":"{}"},{"name":"CallDateTS","type":"\"timestamp\"","metadata":"{}"},{"name":"WatchDateTS","type":"\"timestamp\"","metadata":"{}"},{"name":"ReceivedDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"EntryDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"DispatchDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"ResponseDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"OnSceneDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"TransportDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"HospitalDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"AvailableDtTmTS","type":"\"timestamp\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> unexpected EOF while parsing","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;ipython-input-47-1b6e35bf94f9&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">1</span>\n<span class=\"ansiyellow\">    display(fireServiceCallsTsDF.limit(5)</span>\n<span class=\"ansigrey\">                                         ^</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> unexpected EOF while parsing\n\n</div>","workflows":[],"startTime":1498602103512,"submitTime":1498602103502,"finishTime":1498602104465,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"1838.011364","height":"372.011364","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"46204f67-7bc2-4fae-bf3b-ae3670e070e0"},{"version":"CommandV1","origId":3287337392668986,"guid":"b1f0b355-ee76-4d94-b4fd-2efbad9d50bc","subtype":"command","commandType":"auto","position":3.517578125,"command":"%md Finally calculate how many distinct years of data is in the CSV file: Use the sql utility function _year()_: http://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.functions.year","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"25727c89-2742-49b8-a1f5-dcb9d452735d"},{"version":"CommandV1","origId":3287337392668987,"guid":"32ced584-5f81-48bf-a1c6-8b3b3492e5fe","subtype":"command","commandType":"auto","position":3.51953125,"command":"fireServiceCallsTsDF.select(year('CallDateTS')).distinct().orderBy('year(CallDateTS)').show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+----------------+\n|year(CallDateTS)|\n+----------------+\n|            2000|\n|            2001|\n|            2002|\n|            2003|\n|            2004|\n|            2005|\n|            2006|\n|            2007|\n|            2008|\n|            2009|\n|            2010|\n|            2011|\n|            2012|\n|            2013|\n|            2014|\n|            2015|\n|            2016|\n+----------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AnalysisException</span>: u&quot;cannot resolve &apos;&#96;month(CallDateTS)&#96;&apos; given input columns: [year(CallDateTS)];;\\n&apos;Sort [&apos;month(CallDateTS) ASC NULLS FIRST], true\\n+- Aggregate [year(CallDateTS)#2378], [year(CallDateTS)#2378]\\n   +- Project [year(cast(CallDateTS#1587 as date)) AS year(CallDateTS)#2378]\\n      +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallFinalDisposition#783, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, Location#802, RowID#803, ... 10 more fields]\\n         +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, Location#802, ... 11 more fields]\\n            +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, Location#802, ... 10 more fields]\\n               +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, ... 11 more fields]\\n                  +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, ... 10 more fields]\\n                     +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, ... 11 more fields]\\n                        +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, ... 10 more fields]\\n                           +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, ... 11 more fields]\\n                              +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, ... 10 more fields]\\n                                 +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, ... 11 more fields]\\n                                    +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, ... 10 more fields]\\n                                       +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, ... 11 more fields]\\n                                          +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, ... 10 more fields]\\n                                             +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, ... 11 more fields]\\n                                                +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, ... 10 more fields]\\n                                                   +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, ... 11 more fields]\\n                                                      +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, ... 10 more fields]\\n                                                         +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, WatchDate#775, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, ... 11 more fields]\\n                                                            +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, WatchDate#775, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, ... 10 more fields]\\n                                                               +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallDate#774, WatchDate#775, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ... 11 more fields]\\n                                                                  +- Relation[CallNumber#770,UnitID#771,IncidentNumber#772,CallType#773,CallDate#774,WatchDate#775,ReceivedDtTm#776,EntryDtTm#777,DispatchDtTm#778,ResponseDtTm#779,OnSceneDtTm#780,TransportDtTm#781,HospitalDtTm#782,CallFinalDisposition#783,AvailableDtTm#784,Address#785,City#786,ZipcodeofIncident#787,Battalion#788,StationArea#789,Box#790,OriginalPriority#791,Priority#792,FinalPriority#793,... 10 more fields] csv\\n&quot;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AnalysisException</span>                         Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-22-d2bb6e240c8e&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceCallsTsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span>year<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;CallDateTS&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>distinct<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>orderBy<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;month(CallDateTS)&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/dataframe.pyc</span> in <span class=\"ansicyan\">sort</span><span class=\"ansiblue\">(self, *cols, **kwargs)</span>\n<span class=\"ansigreen\">    826</span>         <span class=\"ansiyellow\">[</span>Row<span class=\"ansiyellow\">(</span>age<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">,</span> name<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;Bob&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> Row<span class=\"ansiyellow\">(</span>age<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">2</span><span class=\"ansiyellow\">,</span> name<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;Alice&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    827</span>         &quot;&quot;&quot;\n<span class=\"ansigreen\">--&gt; 828</span><span class=\"ansiyellow\">         </span>jdf <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">.</span>sort<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_sort_cols<span class=\"ansiyellow\">(</span>cols<span class=\"ansiyellow\">,</span> kwargs<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    829</span>         <span class=\"ansigreen\">return</span> DataFrame<span class=\"ansiyellow\">(</span>jdf<span class=\"ansiyellow\">,</span> self<span class=\"ansiyellow\">.</span>sql_ctx<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    830</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.pyc</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     67</span>                                              e.java_exception.getStackTrace()))\n<span class=\"ansigreen\">     68</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.AnalysisException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 69</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.analysis&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     71</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AnalysisException</span>: u&quot;cannot resolve &apos;&#96;month(CallDateTS)&#96;&apos; given input columns: [year(CallDateTS)];;\\n&apos;Sort [&apos;month(CallDateTS) ASC NULLS FIRST], true\\n+- Aggregate [year(CallDateTS)#2378], [year(CallDateTS)#2378]\\n   +- Project [year(cast(CallDateTS#1587 as date)) AS year(CallDateTS)#2378]\\n      +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallFinalDisposition#783, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, Location#802, RowID#803, ... 10 more fields]\\n         +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, Location#802, ... 11 more fields]\\n            +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, Location#802, ... 10 more fields]\\n               +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, ... 11 more fields]\\n                  +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, NeighborhoodDistrict#801, ... 10 more fields]\\n                     +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, ... 11 more fields]\\n                        +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, SupervisorDistrict#800, ... 10 more fields]\\n                           +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, ... 11 more fields]\\n                              +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, FirePreventionDistrict#799, ... 10 more fields]\\n                                 +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, ... 11 more fields]\\n                                    +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, Unitsequenceincalldispatch#798, ... 10 more fields]\\n                                       +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, ... 11 more fields]\\n                                          +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, UnitType#797, ... 10 more fields]\\n                                             +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, ... 11 more fields]\\n                                                +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, NumberofAlarms#796, ... 10 more fields]\\n                                                   +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, ... 11 more fields]\\n                                                      +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, CallTypeGroup#795, ... 10 more fields]\\n                                                         +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, WatchDate#775, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, ... 11 more fields]\\n                                                            +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, WatchDate#775, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ALSUnit#794, ... 10 more fields]\\n                                                               +- Project [CallNumber#770, UnitID#771, IncidentNumber#772, CallType#773, CallDate#774, WatchDate#775, ReceivedDtTm#776, EntryDtTm#777, DispatchDtTm#778, ResponseDtTm#779, OnSceneDtTm#780, TransportDtTm#781, HospitalDtTm#782, CallFinalDisposition#783, AvailableDtTm#784, Address#785, City#786, ZipcodeofIncident#787, Battalion#788, StationArea#789, Box#790, OriginalPriority#791, Priority#792, FinalPriority#793, ... 11 more fields]\\n                                                                  +- Relation[CallNumber#770,UnitID#771,IncidentNumber#772,CallType#773,CallDate#774,WatchDate#775,ReceivedDtTm#776,EntryDtTm#777,DispatchDtTm#778,ResponseDtTm#779,OnSceneDtTm#780,TransportDtTm#781,HospitalDtTm#782,CallFinalDisposition#783,AvailableDtTm#784,Address#785,City#786,ZipcodeofIncident#787,Battalion#788,StationArea#789,Box#790,OriginalPriority#791,Priority#792,FinalPriority#793,... 10 more fields] csv\\n&quot;</div>","workflows":[],"startTime":1498602819118,"submitTime":1498602819107,"finishTime":1498602832753,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"604b4b78-632c-491e-94af-d8f56a89c416"},{"version":"CommandV1","origId":7685207635898,"guid":"87e94a2b-e327-4ef0-98b2-0997e470bb33","subtype":"command","commandType":"auto","position":3.521484375,"command":"%md **CHALLENGE: Can you show the years in descending order?**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"11cb3617-7a46-4eca-bf68-a8e4a2c20aa3"},{"version":"CommandV1","origId":7685207635899,"guid":"a0184abe-8cb2-4465-acb6-5ceb848a83af","subtype":"command","commandType":"auto","position":3.5224609375,"command":"fireServiceCallsTsDF.select(year('CallDateTS')).distinct().orderBy('year(CallDateTS)', ascending=False).show()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":true,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b2d654a6-8fd1-4b14-a5f7-142bd2121ebb"},{"version":"CommandV1","origId":3287337392668988,"guid":"dc6e2446-f21d-4a46-b2d3-57dd71d9ec27","subtype":"command","commandType":"auto","position":3.5234375,"command":"%md **Q-4) How many service calls were logged in the past 7 days?**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ffe587ce-479e-40d0-893c-7dcbe3ba6af1"},{"version":"CommandV1","origId":3287337392668989,"guid":"0b8a237d-69c1-4713-b70f-0c5808fa71c5","subtype":"command","commandType":"auto","position":3.5244140625,"command":"%md Note that today, July 6th, is the 187th day of the year.\n\nFilter the DF down to just 2016 and days of year greater than 180:\nUse the following SQL utility funcitons:\n* _year()_\n* _dayofyear()_","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f6ccae48-0976-4187-bc51-1b98af64342c"},{"version":"CommandV1","origId":3287337392668990,"guid":"5cddf87f-1a5e-4e06-8f56-3bca9858077a","subtype":"command","commandType":"auto","position":3.525390625,"command":"fireServiceCallsTsDF.filter(year('CallDateTS') == '2016') \\\n  .filter(dayofyear('CallDateTS') >= 180) \\\n  .select(dayofyear('CallDateTS')) \\\n  .distinct().orderBy('dayofyear(CallDateTS)') \\\n  .show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---------------------+\n|dayofyear(CallDateTS)|\n+---------------------+\n|                  180|\n|                  181|\n|                  182|\n|                  183|\n|                  184|\n|                  185|\n|                  186|\n+---------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AnalysisException</span>: u&quot;cannot resolve &apos;&#96;dayofyear(Call Date TS&#96;&apos; given input columns: [dayofyear(Call Date TS)];&quot;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AnalysisException</span>                         Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-80-60df01ef6499&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceCallsTsDF<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>year<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Date TS&apos;</span><span class=\"ansiyellow\">)</span> <span class=\"ansiyellow\">==</span> <span class=\"ansiblue\">&apos;2016&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>dayofyear<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Date TS&apos;</span><span class=\"ansiyellow\">)</span> <span class=\"ansiyellow\">&gt;=</span> <span class=\"ansicyan\">180</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span>dayofyear<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Date TS&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>distinct<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>orderBy<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;dayofyear(Call Date TS&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">20</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/dataframe.py</span> in <span class=\"ansicyan\">sort</span><span class=\"ansiblue\">(self, *cols, **kwargs)</span>\n<span class=\"ansigreen\">    696</span>         <span class=\"ansiyellow\">[</span>Row<span class=\"ansiyellow\">(</span>age<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">,</span> name<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;Bob&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> Row<span class=\"ansiyellow\">(</span>age<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">2</span><span class=\"ansiyellow\">,</span> name<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;Alice&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    697</span>         &quot;&quot;&quot;\n<span class=\"ansigreen\">--&gt; 698</span><span class=\"ansiyellow\">         </span>jdf <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">.</span>sort<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_sort_cols<span class=\"ansiyellow\">(</span>cols<span class=\"ansiyellow\">,</span> kwargs<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    699</span>         <span class=\"ansigreen\">return</span> DataFrame<span class=\"ansiyellow\">(</span>jdf<span class=\"ansiyellow\">,</span> self<span class=\"ansiyellow\">.</span>sql_ctx<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    700</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.1-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">    931</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    932</span>         return_value = get_return_value(\n<span class=\"ansigreen\">--&gt; 933</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">    934</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    935</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     67</span>                                              e.java_exception.getStackTrace()))\n<span class=\"ansigreen\">     68</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.AnalysisException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 69</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.analysis&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     71</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AnalysisException</span>: u&quot;cannot resolve &apos;&#96;dayofyear(Call Date TS&#96;&apos; given input columns: [dayofyear(Call Date TS)];&quot;\n</div>","workflows":[],"startTime":1498604283119,"submitTime":1498604283110,"finishTime":1498604296758,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"457f7e55-47c9-47b7-86e4-18c43582d7f4"},{"version":"CommandV1","origId":7685207635901,"guid":"d75815cb-35a5-46ff-9da8-bebe5bde97ca","subtype":"command","commandType":"auto","position":3.5263671875,"command":"%md What if we want to find out the number of calls on each day of the last 7 days?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a2c96a75-83e7-4872-bb37-2fb64c89785a"},{"version":"CommandV1","origId":3287337392668991,"guid":"08cca8f3-5696-4acf-a45c-6cd433db1d31","subtype":"command","commandType":"auto","position":3.52734375,"command":"fireServiceCallsTsDF.filter(year('CallDateTS') == '2016') \\\n      .filter(dayofyear('CallDateTS') >= 180) \\\n      .groupBy(dayofyear('CallDateTS')) \\\n      .count() \\\n      .orderBy('dayofyear(CallDateTS)') \\\n      .show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+---------------------+-----+\n|dayofyear(CallDateTS)|count|\n+---------------------+-----+\n|                  180|  753|\n|                  181|  731|\n|                  182|  797|\n|                  183|  847|\n|                  184|  729|\n|                  185|  797|\n|                  186|  958|\n+---------------------+-----+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;GroupedData&apos; object has no attribute &apos;distinct&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-82-92c3a88eb40a&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceCallsTsDF<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>year<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Date TS&apos;</span><span class=\"ansiyellow\">)</span> <span class=\"ansiyellow\">==</span> <span class=\"ansiblue\">&apos;2016&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>dayofyear<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Date TS&apos;</span><span class=\"ansiyellow\">)</span> <span class=\"ansiyellow\">&gt;=</span> <span class=\"ansicyan\">180</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>groupBy<span class=\"ansiyellow\">(</span>dayofyear<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;Call Date TS&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>distinct<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>sum<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;GroupedData&apos; object has no attribute &apos;distinct&apos;\n</div>","workflows":[],"startTime":1498604560870,"submitTime":1498604560838,"finishTime":1498604574747,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"06506c9e-b1eb-40a2-b9fb-8a87bb2a3fa0"},{"version":"CommandV1","origId":3287337392668992,"guid":"17b8a5d5-f70e-4a3a-b817-80ec9361b116","subtype":"command","commandType":"auto","position":3.53125,"command":"%md Note above that July 4th, 2016 was the 185th day of the year.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9715a67b-d942-40e6-937a-124bd397b156"},{"version":"CommandV1","origId":3287337392668993,"guid":"0f7a5000-60f8-4c1f-9ca0-5b53cd514b32","subtype":"command","commandType":"auto","position":3.55859375,"command":"%md Visualize the results in a bar graph:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bb113a1b-4585-4509-b8e3-629f4429ed1a"},{"version":"CommandV1","origId":3287337392668994,"guid":"e92108d9-5d57-4799-9444-46425385776b","subtype":"command","commandType":"auto","position":3.5859375,"command":"display(fireServiceCallsTsDF.filter(year('CallDateTS') == '2016').filter(dayofyear('CallDateTS') >= 180).groupBy(dayofyear('CallDateTS')).count().orderBy('dayofyear(CallDateTS)'))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[180,753],[181,731],[182,797],[183,847],[184,729],[185,797],[186,958]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"dayofyear(CallDateTS)","type":"\"integer\"","metadata":"{}"},{"name":"count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498604731901,"submitTime":1498604731891,"finishTime":1498604745808,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"928.011364","height":"294.011364","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f8b71d86-dde1-4846-9f72-36bad916c8e7"},{"version":"CommandV1","origId":3287337392668995,"guid":"b3de0176-077d-44b8-ac07-6f3a7bc67f8b","subtype":"command","commandType":"auto","position":3.75,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** Memory, Caching and Write to Parquet**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6ad5c201-a14f-4496-8b0e-76dfd5a94ba4"},{"version":"CommandV1","origId":3287337392668996,"guid":"92a03e03-6fc5-4b5a-ad32-2e48a6645de3","subtype":"command","commandType":"auto","position":3.7529296875,"command":"%md The DataFrame is currently comprised of 13 partitions:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0401bcf4-7174-4944-91ea-88c7f3688a33"},{"version":"CommandV1","origId":3287337392668997,"guid":"c94736aa-54ad-4b94-83b3-80ddf1985cf4","subtype":"command","commandType":"auto","position":3.755859375,"command":"fireServiceCallsTsDF.rdd.getNumPartitions()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">22</span><span class=\"ansired\">]: </span>13\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1467847982074,"submitTime":1467847937273,"finishTime":1467847982197,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"20f7c477-b831-4003-a688-efe48999be3d"},{"version":"CommandV1","origId":3287337392668998,"guid":"4ede352d-bac2-416f-9146-435b47ac8b30","subtype":"command","commandType":"auto","position":3.7587890625,"command":"%md ![Partitions](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/df_13_parts.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6d7383b9-cc9e-4ef2-bcc7-642462847ad0"},{"version":"CommandV1","origId":3287337392668999,"guid":"b609958d-d337-4f5b-9c53-ac02f57c28da","subtype":"command","commandType":"auto","position":3.7734375,"command":"fireServiceCallsTsDF.repartition(6).createOrReplaceTempView(\"fireServiceVIEW\");","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsTsAllDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-23-aed80c756905&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceCallsTsAllDF<span class=\"ansiyellow\">.</span>repartition<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">6</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>createOrReplaceTempView<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;fireServiceVIEW&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">;</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;fireServiceCallsTsAllDF&apos; is not defined\n</div>","workflows":[],"startTime":1498605143117,"submitTime":1498605143109,"finishTime":1498605143190,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"35b68f37-e56c-4fd1-a519-fe30d8399f6a"},{"version":"CommandV1","origId":3287337392669000,"guid":"eae2534a-4bee-4307-ac20-8cc84c2c7eee","subtype":"command","commandType":"auto","position":3.78515625,"command":"spark.catalog.cacheTable(\"fireServiceVIEW\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AnalysisException</span>: u&quot;Table or view &apos;fireserviceview&apos; not found in database &apos;default&apos;;&quot;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AnalysisException</span>                         Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-24-560ec0276ce3&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>spark<span class=\"ansiyellow\">.</span>catalog<span class=\"ansiyellow\">.</span>cacheTable<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;fireServiceVIEW&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/catalog.py</span> in <span class=\"ansicyan\">cacheTable</span><span class=\"ansiblue\">(self, tableName)</span>\n<span class=\"ansigreen\">    221</span>     <span class=\"ansigreen\">def</span> cacheTable<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> tableName<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    222</span>         <span class=\"ansiblue\">&quot;&quot;&quot;Caches the specified table in-memory.&quot;&quot;&quot;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 223</span><span class=\"ansiyellow\">         </span>self<span class=\"ansiyellow\">.</span>_jcatalog<span class=\"ansiyellow\">.</span>cacheTable<span class=\"ansiyellow\">(</span>tableName<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    224</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    225</span>     <span class=\"ansiyellow\">@</span>since<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">2.0</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.1-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">    931</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    932</span>         return_value = get_return_value(\n<span class=\"ansigreen\">--&gt; 933</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">    934</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    935</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     69</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.analysis&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 71</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     72</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.parser.ParseException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     73</span>                 <span class=\"ansigreen\">raise</span> ParseException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AnalysisException</span>: u&quot;Table or view &apos;fireserviceview&apos; not found in database &apos;default&apos;;&quot;\n</div>","workflows":[],"startTime":1498605148809,"submitTime":1498605148800,"finishTime":1498605148932,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b0b30bf-17dd-42bb-848c-e72483a2c63f"},{"version":"CommandV1","origId":3287337392669001,"guid":"77e3b326-5547-4938-909d-6171ab95f734","subtype":"command","commandType":"auto","position":3.8203125,"command":"# Call .count() to materialize the cache\nspark.table(\"fireServiceVIEW\").count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">41</span><span class=\"ansired\">]: </span>4091248\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498605163255,"submitTime":1498605163247,"finishTime":1498605244488,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ef8871fc-2121-4268-96a8-00bdc9a389d8"},{"version":"CommandV1","origId":3287337392669002,"guid":"86abd72f-d1b6-4b90-9f7a-f789882605ed","subtype":"command","commandType":"auto","position":3.83203125,"command":"fireServiceDF = spark.table(\"fireServiceVIEW\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498605287638,"submitTime":1498605287629,"finishTime":1498605287761,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6366fc69-cd60-401f-8433-54cbb783c701"},{"version":"CommandV1","origId":3287337392669003,"guid":"d2cc6184-69ef-438b-825d-f56a45475a89","subtype":"command","commandType":"auto","position":3.837890625,"command":"# Note that the full scan + count in memory takes < 1 second!\n\nfireServiceDF.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">44</span><span class=\"ansired\">]: </span>4091248\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;fireServiceDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-42-6fcee5fb75c1&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansired\"># Note that the full scan + count in memory takes &lt; 1 second!</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 3</span><span class=\"ansiyellow\"> </span>fireServiceDF<span class=\"ansiyellow\">.</span>count<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;fireServiceDF&apos; is not defined</div>","workflows":[],"startTime":1498605293983,"submitTime":1498605293974,"finishTime":1498605294564,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1eae476e-6eb9-4bca-b94b-d8818bb85450"},{"version":"CommandV1","origId":3287337392669004,"guid":"5e8b2397-3b88-46fe-8ab9-913d9aac14ba","subtype":"command","commandType":"auto","position":3.838623046875,"command":"spark.catalog.isCached(\"fireServiceVIEW\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">45</span><span class=\"ansired\">]: </span>True\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498605384450,"submitTime":1498605384442,"finishTime":1498605384521,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a0578d0d-2033-4f27-ad1a-75f89ebf084d"},{"version":"CommandV1","origId":3287337392669005,"guid":"3ca7b5d3-be15-4d45-84ac-e45d8d03efac","subtype":"command","commandType":"auto","position":3.83935546875,"command":"%md The 6 partitions are now cached in memory:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"343cb2b4-c9ed-41ba-ac9a-f4afc86a1659"},{"version":"CommandV1","origId":3287337392669006,"guid":"7c64cafb-6d1a-480c-bd98-20ddee886c61","subtype":"command","commandType":"auto","position":3.8408203125,"command":"%md ![6 Partitions](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/df_6_parts.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c807ffd5-5445-4892-b915-98fe15dfdd41"},{"version":"CommandV1","origId":3287337392669007,"guid":"d65459ba-3a2d-4cd3-a1c6-923bd6e53d37","subtype":"command","commandType":"auto","position":3.84228515625,"command":"%md Use the Spark UI to see the 6 partitions in memory:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8b58a128-58bc-46c0-bd43-318cde898db0"},{"version":"CommandV1","origId":3287337392669008,"guid":"93003d70-f736-4489-a49f-04e573e6111b","subtype":"command","commandType":"auto","position":3.843017578125,"command":"%md ![Mem UI](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/mem_ui.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"312648e1-50ec-464d-892b-f6dea755fc19"},{"version":"CommandV1","origId":3287337392669009,"guid":"65125d24-2f8a-4b6c-8a80-74e73fe0b0fd","subtype":"command","commandType":"auto","position":3.84320068359375,"command":"%md Now that our data has the correct date types for each column and it is correctly partitioned, let's write it down as a parquet file for future loading:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7a88f151-f34e-4ebc-95e8-b690851a3430"},{"version":"CommandV1","origId":3287337392669010,"guid":"aab0e11f-ff9a-424f-a662-0499a6dff1e2","subtype":"command","commandType":"auto","position":3.843292236328125,"command":"%fs ls /tmp/","commandVersion":0,"state":"finished","results":{"type":"table","data":[["dbfs:/tmp/hive/","hive/",0],["dbfs:/tmp/iotDevicesParquet/","iotDevicesParquet/",0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"path","type":"\"string\"","metadata":"{}"},{"name":"name","type":"\"string\"","metadata":"{}"},{"name":"size","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":"<div class=\"ansiout\">&lt;console&gt;:32: error: value mkdir is not a member of com.databricks.dbutils_v1.DbfsUtils\n              dbutils.fs.mkdir(&quot;/tmp/fireServiceParquet/&quot;)\n                         ^\n</div>","error":null,"workflows":[],"startTime":1498605598785,"submitTime":1498605598753,"finishTime":1498605599349,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fb9bb236-9edd-4124-afcc-b063303800e1"},{"version":"CommandV1","origId":3287337392669011,"guid":"9e19922e-bbae-46e9-84ae-eb43905a37b5","subtype":"command","commandType":"auto","position":3.8433837890625,"command":"fireServiceDF.write.format('parquet').save('/tmp/fireServiceParquet/')","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AnalysisException</span>: u&apos;Attribute name &quot;Call Number&quot; contains invalid character(s) among &quot; ,;{}()\\\\n\\\\t=&quot;. Please use alias to rename it.;&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AnalysisException</span>                         Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-136-a6be22c6777c&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireServiceDF<span class=\"ansiyellow\">.</span>write<span class=\"ansiyellow\">.</span>format<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;parquet&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>save<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;/tmp/fireServiceParquet/&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/readwriter.py</span> in <span class=\"ansicyan\">save</span><span class=\"ansiblue\">(self, path, format, mode, partitionBy, **options)</span>\n<span class=\"ansigreen\">    592</span>             self<span class=\"ansiyellow\">.</span>_jwrite<span class=\"ansiyellow\">.</span>save<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    593</span>         <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 594</span><span class=\"ansiyellow\">             </span>self<span class=\"ansiyellow\">.</span>_jwrite<span class=\"ansiyellow\">.</span>save<span class=\"ansiyellow\">(</span>path<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    595</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    596</span>     <span class=\"ansiyellow\">@</span>since<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">1.4</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.1-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">    931</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    932</span>         return_value = get_return_value(\n<span class=\"ansigreen\">--&gt; 933</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">    934</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    935</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     67</span>                                              e.java_exception.getStackTrace()))\n<span class=\"ansigreen\">     68</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.AnalysisException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 69</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.analysis&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     71</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AnalysisException</span>: u&apos;Attribute name &quot;Call Number&quot; contains invalid character(s) among &quot; ,;{}()\\\\n\\\\t=&quot;. Please use alias to rename it.;&apos;\n</div>","workflows":[],"startTime":1498605609413,"submitTime":1498605609404,"finishTime":1498605642206,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"da34baa9-599d-48c9-a469-2ea7f80298af"},{"version":"CommandV1","origId":3287337392669012,"guid":"4802b8d0-9d1b-4ce3-beac-25f3cc7f4765","subtype":"command","commandType":"auto","position":3.843475341796875,"command":"%md Now the directory should contain 6 .gz compressed Parquet files (one for each partition):","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"121222c9-50cb-4ab7-b099-1fd157e2a26d"},{"version":"CommandV1","origId":3287337392669013,"guid":"372220b9-adbf-4f03-92c3-a2603ed64872","subtype":"command","commandType":"auto","position":3.84356689453125,"command":"%fs ls /tmp/fireServiceParquet/","commandVersion":0,"state":"finished","results":{"type":"table","data":[["dbfs:/tmp/fireServiceParquet/_SUCCESS","_SUCCESS",0],["dbfs:/tmp/fireServiceParquet/_committed_1629459603693795973","_committed_1629459603693795973",576],["dbfs:/tmp/fireServiceParquet/_started_1629459603693795973","_started_1629459603693795973",0],["dbfs:/tmp/fireServiceParquet/part-00000-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet","part-00000-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet",58493679],["dbfs:/tmp/fireServiceParquet/part-00001-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet","part-00001-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet",58499178],["dbfs:/tmp/fireServiceParquet/part-00002-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet","part-00002-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet",58487469],["dbfs:/tmp/fireServiceParquet/part-00003-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet","part-00003-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet",58438250],["dbfs:/tmp/fireServiceParquet/part-00004-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet","part-00004-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet",58742713],["dbfs:/tmp/fireServiceParquet/part-00005-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet","part-00005-tid-1629459603693795973-3d59aebf-a395-4fa4-a173-743c03c33e21-0-c000.gz.parquet",58492411]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"path","type":"\"string\"","metadata":"{}"},{"name":"name","type":"\"string\"","metadata":"{}"},{"name":"size","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498605655570,"submitTime":1498605655561,"finishTime":1498605656000,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7c0a2021-9620-4704-8f35-c6f723197068"},{"version":"CommandV1","origId":3287337392669014,"guid":"be445ec4-4de1-46c2-aa45-bba68ff25862","subtype":"command","commandType":"auto","position":3.8436126708984375,"command":"%md Here's how you can easily read the parquet file from S3 in the future:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7d925231-83d1-4f8c-818f-560188abab04"},{"version":"CommandV1","origId":3287337392669015,"guid":"092a6333-fd7a-477d-878c-e478846cabc2","subtype":"command","commandType":"auto","position":3.843658447265625,"command":"tempDF = spark.read.parquet('/tmp/fireServiceParquet/')","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: parquet() got an unexpected keyword argument &apos;inferSchema&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-32-80da0cde4899&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>tempDF <span class=\"ansiyellow\">=</span> spark<span class=\"ansiyellow\">.</span>read<span class=\"ansiyellow\">.</span>parquet<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;/tmp/fireServiceParquet/&apos;</span><span class=\"ansiyellow\">,</span> inferSchema<span class=\"ansiyellow\">=</span>True<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: parquet() got an unexpected keyword argument &apos;inferSchema&apos;\n</div>","workflows":[],"startTime":1498605745894,"submitTime":1498605745887,"finishTime":1498605746620,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"38f44ead-e244-4b93-8c8a-9a105aa833fd"},{"version":"CommandV1","origId":3287337392669016,"guid":"0edc99f5-e347-4c97-8418-ebffa1b3b590","subtype":"command","commandType":"auto","position":3.8437042236328125,"command":"display(tempDF.limit(2))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[160941229,"62",16037213,"Medical Incident","Code 2 Transport","CABRILLO ST/LA PLAYA","San Francisco",94121,"B07","34","7277","2","2",2,true,"Non Life-threatening",1,"MEDIC",1,"7","1","Outer Richmond","(37.7732594685752, -122.510036956026)","160941229-62","2016-04-03T00:00:00.000+0000","2016-04-03T00:00:00.000+0000","2016-04-03T10:11:05.000+0000","2016-04-03T10:13:32.000+0000","2016-04-03T10:13:50.000+0000","2016-04-03T10:14:04.000+0000","2016-04-03T10:17:26.000+0000","2016-04-03T10:28:20.000+0000","2016-04-03T11:00:27.000+0000","2016-04-03T11:27:46.000+0000"],[142463717,"RC1",14085854,"Medical Incident","Code 2 Transport","300 Block of JONES ST","San Francisco",94102,"B03","3","1461","2","2",2,true,"Potentially Life-Threatening",1,"RESCUE CAPTAIN",5,"3","6","Tenderloin","(37.7844080259171, -122.412620351644)","142463717-RC1","2014-09-03T00:00:00.000+0000","2014-09-03T00:00:00.000+0000","2014-09-03T21:19:57.000+0000","2014-09-03T21:19:57.000+0000","2014-09-03T21:59:44.000+0000","2014-09-03T22:02:23.000+0000","2016-04-25T13:15:17.000+0000","2016-04-25T13:15:17.000+0000","2016-04-25T13:15:17.000+0000","2014-09-03T22:11:32.000+0000"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"CallNumber","type":"\"integer\"","metadata":"{}"},{"name":"UnitID","type":"\"string\"","metadata":"{}"},{"name":"IncidentNumber","type":"\"integer\"","metadata":"{}"},{"name":"CallType","type":"\"string\"","metadata":"{}"},{"name":"CallFinalDisposition","type":"\"string\"","metadata":"{}"},{"name":"Address","type":"\"string\"","metadata":"{}"},{"name":"City","type":"\"string\"","metadata":"{}"},{"name":"ZipcodeofIncident","type":"\"integer\"","metadata":"{}"},{"name":"Battalion","type":"\"string\"","metadata":"{}"},{"name":"StationArea","type":"\"string\"","metadata":"{}"},{"name":"Box","type":"\"string\"","metadata":"{}"},{"name":"OriginalPriority","type":"\"string\"","metadata":"{}"},{"name":"Priority","type":"\"string\"","metadata":"{}"},{"name":"FinalPriority","type":"\"integer\"","metadata":"{}"},{"name":"ALSUnit","type":"\"boolean\"","metadata":"{}"},{"name":"CallTypeGroup","type":"\"string\"","metadata":"{}"},{"name":"NumberofAlarms","type":"\"integer\"","metadata":"{}"},{"name":"UnitType","type":"\"string\"","metadata":"{}"},{"name":"Unitsequenceincalldispatch","type":"\"integer\"","metadata":"{}"},{"name":"FirePreventionDistrict","type":"\"string\"","metadata":"{}"},{"name":"SupervisorDistrict","type":"\"string\"","metadata":"{}"},{"name":"NeighborhoodDistrict","type":"\"string\"","metadata":"{}"},{"name":"Location","type":"\"string\"","metadata":"{}"},{"name":"RowID","type":"\"string\"","metadata":"{}"},{"name":"CallDateTS","type":"\"timestamp\"","metadata":"{}"},{"name":"WatchDateTS","type":"\"timestamp\"","metadata":"{}"},{"name":"ReceivedDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"EntryDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"DispatchDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"ResponseDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"OnSceneDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"TransportDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"HospitalDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"AvailableDtTmTS","type":"\"timestamp\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498605751989,"submitTime":1498605751981,"finishTime":1498605753370,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9faa8b7d-957b-459a-8933-6f8f3fcbee0c"},{"version":"CommandV1","origId":3287337392669017,"guid":"44307c98-04ac-4a0c-b6e6-e684cfd759ae","subtype":"command","commandType":"auto","position":3.8437271118164062,"command":"%md Did you know that the new vectorized Parquet decoder in Spark 2.0 has improved Parquet scan throughput by 3x?","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c61b7fa3-9a04-4a4a-a146-4a810c745271"},{"version":"CommandV1","origId":3287337392669018,"guid":"61cfff48-458e-4d39-8db3-db45e2fd8c18","subtype":"command","commandType":"auto","position":3.84375,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **SQL Queries**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"18195424-999d-4181-8109-cf71cfdc02fc"},{"version":"CommandV1","origId":3287337392669019,"guid":"442a3d04-3479-4cb5-ba1f-2f8f731b3707","subtype":"command","commandType":"auto","position":3.96875,"command":"%sql SELECT count(*) FROM fireServiceVIEW;","commandVersion":0,"state":"finished","results":{"type":"table","data":[[4091248]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"count(1)","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498605804957,"submitTime":1498605804944,"finishTime":1498605805433,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"58b04672-19ec-4afe-92c0-1306804f2b82"},{"version":"CommandV1","origId":3287337392669022,"guid":"4612e3b3-b9da-4a77-9322-f86a5f4c0034","subtype":"command","commandType":"auto","position":4.984375,"command":"%md You can use the Spark Stages UI to see the 6 tasks launched in the middle stage:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cab1a9c1-1f70-4c02-95f2-13d1f4c145c1"},{"version":"CommandV1","origId":3287337392669023,"guid":"7d0e0b22-d4c1-4305-80a7-d865cdd548ef","subtype":"command","commandType":"auto","position":5.0625,"command":"%md ![Event Timeline](http://curriculum-release.s3-website-us-west-2.amazonaws.com/sf_open_data_meetup/event_timeline.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"11eb4c10-01cb-43b7-8294-93c39c3a8e08"},{"version":"CommandV1","origId":3287337392669024,"guid":"45e7bae1-e74b-4874-a4a1-91d187725b04","subtype":"command","commandType":"auto","position":5.21875,"command":"%md **Q-5) Which neighborhood in SF generated the most calls in year 2015?**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4c48fd18-3cfc-4a36-8cbf-902c29a2a677"},{"version":"CommandV1","origId":3287337392669025,"guid":"bcf3b60c-81ea-44f1-9afc-3b9fea09f8e3","subtype":"command","commandType":"auto","position":6.21875,"command":"%sql SELECT `NeighborhoodDistrict`, count(`NeighborhoodDistrict`) AS Neighborhood_Count FROM fireServiceVIEW WHERE year(`CallDateTS`) == '2015' GROUP BY `NeighborhoodDistrict` ORDER BY Neighborhood_Count DESC LIMIT 15;","commandVersion":0,"state":"finished","results":{"type":"table","data":[["Tenderloin",39607],["South of Market",30550],["Mission",26638],["Financial District/South Beach",21301],["Bayview Hunters Point",14678],["Sunset/Parkside",11265],["Western Addition",10514],["Nob Hill",10344],["Outer Richmond",7802],["Hayes Valley",7594],["Castro/Upper Market",7493],["North Beach",6822],["Pacific Heights",6475],["West of Twin Peaks",6265],["Chinatown",6214]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"NeighborhoodDistrict","type":"\"string\"","metadata":"{}"},{"name":"Neighborhood_Count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":"Error in SQL statement: AnalysisException: cannot resolve '`Call Date TS`' given input columns: [RowID, CallType, IncidentNumber, OnSceneDtTmTS, AvailableDtTmTS, ZipcodeofIncident, NeighborhoodDistrict, ALSUnit, EntryDtTmTS, Priority, FirePreventionDistrict, HospitalDtTmTS, Unitsequenceincalldispatch, Address, Location, Box, DispatchDtTmTS, ResponseDtTmTS, WatchDateTS, TransportDtTmTS, OriginalPriority, ReceivedDtTmTS, UnitType, CallFinalDisposition, CallNumber, StationArea, UnitID, NumberofAlarms, SupervisorDistrict, CallTypeGroup, City, CallDateTS, Battalion, FinalPriority]; line 1 pos 119","error":"com.databricks.backend.common.rpc.DatabricksExceptions$SQLExecutionException: org.apache.spark.sql.AnalysisException: cannot resolve '`Call Date TS`' given input columns: [RowID, CallType, IncidentNumber, OnSceneDtTmTS, AvailableDtTmTS, ZipcodeofIncident, NeighborhoodDistrict, ALSUnit, EntryDtTmTS, Priority, FirePreventionDistrict, HospitalDtTmTS, Unitsequenceincalldispatch, Address, Location, Box, DispatchDtTmTS, ResponseDtTmTS, WatchDateTS, TransportDtTmTS, OriginalPriority, ReceivedDtTmTS, UnitType, CallFinalDisposition, CallNumber, StationArea, UnitID, NumberofAlarms, SupervisorDistrict, CallTypeGroup, City, CallDateTS, Battalion, FinalPriority]; line 1 pos 119\n\tat org.apache.spark.sql.catalyst.analysis.package$AnalysisErrorAt.failAnalysis(package.scala:42)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1$$anonfun$apply$2.applyOrElse(CheckAnalysis.scala:62)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1$$anonfun$apply$2.applyOrElse(CheckAnalysis.scala:59)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$transformUp$1.apply(TreeNode.scala:301)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$transformUp$1.apply(TreeNode.scala:301)\n\tat org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:69)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:300)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$4.apply(TreeNode.scala:298)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$4.apply(TreeNode.scala:298)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$5$$anonfun$apply$11.apply(TreeNode.scala:350)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)\n\tat scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)\n\tat scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:244)\n\tat scala.collection.AbstractTraversable.map(Traversable.scala:105)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$5.apply(TreeNode.scala:348)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:179)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformChildren(TreeNode.scala:319)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:298)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$4.apply(TreeNode.scala:298)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$4.apply(TreeNode.scala:298)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$5.apply(TreeNode.scala:321)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:179)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformChildren(TreeNode.scala:319)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:298)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpressionUp$1(QueryPlan.scala:190)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.org$apache$spark$sql$catalyst$plans$QueryPlan$$recursiveTransform$2(QueryPlan.scala:200)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$5.apply(QueryPlan.scala:209)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:179)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpressionsUp(QueryPlan.scala:209)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:59)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:52)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:126)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat scala.collection.immutable.List.foreach(List.scala:318)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat scala.collection.immutable.List.foreach(List.scala:318)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat scala.collection.immutable.List.foreach(List.scala:318)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:125)\n\tat scala.collection.immutable.List.foreach(List.scala:318)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:125)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$class.checkAnalysis(CheckAnalysis.scala:52)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:58)\n\tat org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:49)\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:64)\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:573)\n\tat org.apache.spark.sql.SQLContext.sql(SQLContext.scala:682)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:82)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal$$anonfun$1.apply(SQLDriverLocal.scala:28)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)\n\tat scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)\n\tat scala.collection.immutable.List.foreach(List.scala:318)\n\tat scala.collection.TraversableLike$class.map(TraversableLike.scala:244)\n\tat scala.collection.AbstractTraversable.map(Traversable.scala:105)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:28)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:128)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:170)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:170)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:118)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:57)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:113)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:32)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:151)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:32)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:169)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$3.apply(DriverWrapper.scala:483)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$3.apply(DriverWrapper.scala:483)\n\tat scala.util.Try$.apply(Try.scala:161)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:480)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:381)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:212)\n\tat java.lang.Thread.run(Thread.java:745)\n\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.executeSql(SQLDriverLocal.scala:116)\n\tat com.databricks.backend.daemon.driver.SQLDriverLocal.repl(SQLDriverLocal.scala:128)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:170)\n\tat com.databricks.backend.daemon.driver.DriverLocal$$anonfun$execute$3.apply(DriverLocal.scala:170)\n\tat com.databricks.logging.UsageLogging$$anonfun$withAttributionContext$1.apply(UsageLogging.scala:118)\n\tat scala.util.DynamicVariable.withValue(DynamicVariable.scala:57)\n\tat com.databricks.logging.UsageLogging$class.withAttributionContext(UsageLogging.scala:113)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionContext(DriverLocal.scala:32)\n\tat com.databricks.logging.UsageLogging$class.withAttributionTags(UsageLogging.scala:151)\n\tat com.databricks.backend.daemon.driver.DriverLocal.withAttributionTags(DriverLocal.scala:32)\n\tat com.databricks.backend.daemon.driver.DriverLocal.execute(DriverLocal.scala:169)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$3.apply(DriverWrapper.scala:483)\n\tat com.databricks.backend.daemon.driver.DriverWrapper$$anonfun$3.apply(DriverWrapper.scala:483)\n\tat scala.util.Try$.apply(Try.scala:161)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.executeCommand(DriverWrapper.scala:480)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.runInner(DriverWrapper.scala:381)\n\tat com.databricks.backend.daemon.driver.DriverWrapper.run(DriverWrapper.scala:212)\n\tat java.lang.Thread.run(Thread.java:745)\n","workflows":[],"startTime":1498606872408,"submitTime":1498606872399,"finishTime":1498606874090,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"660","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fd53580d-a461-42a3-8ab4-c0d7e09f2528"},{"version":"CommandV1","origId":3287337392669026,"guid":"6466a607-6599-4292-b931-4e1b571f80e7","subtype":"command","commandType":"auto","position":6.34375,"command":"%md Expand the Spark Job details in the cell above and notice that the last stage uses 200 partitions! This is default is non-optimal, given that we only have ~1.6 GB of data and 3 slots.\n\nChange the shuffle.partitions option to 6:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3b419571-b48e-4620-9252-6324c14aaf63"},{"version":"CommandV1","origId":3287337392669027,"guid":"a72dc86a-9425-4658-9130-62cbe293a556","subtype":"command","commandType":"auto","position":6.375,"command":"spark.conf.get(\"spark.sql.shuffle.partitions\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">49</span><span class=\"ansired\">]: </span>u&apos;200&apos;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498606939659,"submitTime":1498606939651,"finishTime":1498606939730,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6c62e4b1-e2cc-42ba-8268-09665462fb1a"},{"version":"CommandV1","origId":3287337392669028,"guid":"a8b6c3b2-0f20-46ea-b02e-c14e83f3012d","subtype":"command","commandType":"auto","position":6.40625,"command":"spark.conf.set(\"spark.sql.shuffle.partitions\", 6)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498606942173,"submitTime":1498606942141,"finishTime":1498606942244,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"05f53194-93f8-4928-8195-267cb0760574"},{"version":"CommandV1","origId":3287337392669029,"guid":"753cbc5a-e5e1-4184-b11b-604144486140","subtype":"command","commandType":"auto","position":6.4375,"command":"spark.conf.get(\"spark.sql.shuffle.partitions\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">51</span><span class=\"ansired\">]: </span>u&apos;6&apos;\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498606943646,"submitTime":1498606943622,"finishTime":1498606943717,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bff0d63d-c6f1-4593-9d25-76fb5feb6679"},{"version":"CommandV1","origId":3287337392669030,"guid":"400dfbc3-18f2-473c-9cdc-c9d2a1aaa2a4","subtype":"command","commandType":"auto","position":6.453125,"command":"%md Re-run the same SQL query and notice the speed increase:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"15f5272d-73b4-4181-892f-7a40e95bca2c"},{"version":"CommandV1","origId":3287337392669031,"guid":"627e92e3-75cd-45ec-8344-187f57be4802","subtype":"command","commandType":"auto","position":6.4609375,"command":"%sql SELECT `NeighborhoodDistrict`, count(`NeighborhoodDistrict`) AS Neighborhood_Count FROM fireServiceVIEW WHERE year(`CallDateTS`) == '2015' GROUP BY `NeighborhoodDistrict` ORDER BY Neighborhood_Count DESC LIMIT 15;","commandVersion":0,"state":"finished","results":{"type":"table","data":[["Tenderloin",39607],["South of Market",30550],["Mission",26638],["Financial District/South Beach",21301],["Bayview Hunters Point",14678],["Sunset/Parkside",11265],["Western Addition",10514],["Nob Hill",10344],["Outer Richmond",7802],["Hayes Valley",7594],["Castro/Upper Market",7493],["North Beach",6822],["Pacific Heights",6475],["West of Twin Peaks",6265],["Chinatown",6214]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"NeighborhoodDistrict","type":"\"string\"","metadata":"{}"},{"name":"Neighborhood_Count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498606950276,"submitTime":1498606950267,"finishTime":1498606950916,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f7fb9d29-353e-4610-bbb0-f63ce3dbaa9c"},{"version":"CommandV1","origId":3287337392669032,"guid":"3ab1ca05-8146-4294-b7ac-05d4b7831e93","subtype":"command","commandType":"auto","position":6.46875,"command":"%md SQL also has some handy commands like `DESC` (describe) to see the schema + data types for the table:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9ba4eaa5-5ae5-4dd9-8778-2f1123eb57e2"},{"version":"CommandV1","origId":3287337392669033,"guid":"0e130718-9cf6-4788-8cc7-34815b92f045","subtype":"command","commandType":"auto","position":6.71875,"command":"%sql DESC fireServiceVIEW;","commandVersion":0,"state":"finished","results":{"type":"table","data":[["CallNumber","int",null],["UnitID","string",null],["IncidentNumber","int",null],["CallType","string",null],["CallFinalDisposition","string",null],["Address","string",null],["City","string",null],["ZipcodeofIncident","int",null],["Battalion","string",null],["StationArea","string",null],["Box","string",null],["OriginalPriority","string",null],["Priority","string",null],["FinalPriority","int",null],["ALSUnit","boolean",null],["CallTypeGroup","string",null],["NumberofAlarms","int",null],["UnitType","string",null],["Unitsequenceincalldispatch","int",null],["FirePreventionDistrict","string",null],["SupervisorDistrict","string",null],["NeighborhoodDistrict","string",null],["Location","string",null],["RowID","string",null],["CallDateTS","timestamp",null],["WatchDateTS","timestamp",null],["ReceivedDtTmTS","timestamp",null],["EntryDtTmTS","timestamp",null],["DispatchDtTmTS","timestamp",null],["ResponseDtTmTS","timestamp",null],["OnSceneDtTmTS","timestamp",null],["TransportDtTmTS","timestamp",null],["HospitalDtTmTS","timestamp",null],["AvailableDtTmTS","timestamp",null]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"col_name","type":"\"string\"","metadata":"{\"comment\":\"name of the column\"}"},{"name":"data_type","type":"\"string\"","metadata":"{\"comment\":\"data type of the column\"}"},{"name":"comment","type":"\"string\"","metadata":"{\"comment\":\"comment of the column\"}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498606968181,"submitTime":1498606968172,"finishTime":1498606968230,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7aa3ff05-8638-4c62-a6ab-af80ee775c75"},{"version":"CommandV1","origId":3287337392669041,"guid":"78c3fe04-7a5f-4ded-baeb-1ae015e468d4","subtype":"command","commandType":"auto","position":10.46875,"command":"%md ### ![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** DataFrame Joins**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fe9147bf-9a30-433d-820f-13f4481a7c66"},{"version":"CommandV1","origId":3287337392669042,"guid":"3e095c4e-dd32-4949-a500-8ff3a0d3bc61","subtype":"command","commandType":"auto","position":10.96875,"command":"%md **Q-6) What was the primary non-medical reason most people called the fire department from the Tenderloin last year?**","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1697ccfd-8da9-49a7-a65a-4b342898ece5"},{"version":"CommandV1","origId":3287337392669043,"guid":"5a058f45-0634-4fd4-ad9d-6ed804717622","subtype":"command","commandType":"auto","position":11.46875,"command":"%md The \"Fire Incidents\" data includes a summary of each (non-medical) incident to which the SF Fire Department responded.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2588412b-2fb3-43aa-9652-67b080906ef3"},{"version":"CommandV1","origId":3287337392669044,"guid":"de7642eb-12f6-4e12-a329-7703f0f347f9","subtype":"command","commandType":"auto","position":11.96875,"command":"%md Let's do a join to the Fire Incidents data on the \"Incident Number\" column:\n\nhttps://data.sfgov.org/Public-Safety/Fire-Incidents/wr8u-xric","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8b7de7c4-f0e8-4d71-b4ca-c1964da69787"},{"version":"CommandV1","origId":3287337392669045,"guid":"d31bc55f-9c46-461e-b3f2-21a7a496d9e5","subtype":"command","commandType":"auto","position":12.21875,"command":"%md Read the Fire Incidents CSV file into a DataFrame:","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"63b1ec93-91c3-45a5-b9c7-bc6ec04dbad7"},{"version":"CommandV1","origId":3287337392669046,"guid":"462dca8f-6b83-490b-9d75-3ab0ea056d06","subtype":"command","commandType":"auto","position":12.46875,"command":"incidentsDF = spark.read.csv('/mnt/sf_open_data/fire_incidents/Fire_Incidents.csv', header=True, inferSchema=True).withColumnRenamed('Incident Number', 'IncidentNumber').cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498607922104,"submitTime":1498607922096,"finishTime":1498607924223,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6e94e9a9-b1fe-43f7-964c-98b7bb5011aa"},{"version":"CommandV1","origId":3287337392669047,"guid":"a510db4e-48d3-4748-bdb6-c066d36442b0","subtype":"command","commandType":"auto","position":12.71875,"command":"incidentsDF.printSchema()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- IncidentNumber: integer (nullable = true)\n |-- Exposure Number: integer (nullable = true)\n |-- Address: string (nullable = true)\n |-- Incident Date: string (nullable = true)\n |-- Call Number: integer (nullable = true)\n |-- Alarm DtTm: string (nullable = true)\n |-- Arrival DtTm: string (nullable = true)\n |-- Close DtTm: string (nullable = true)\n |-- City: string (nullable = true)\n |-- Zipcode: integer (nullable = true)\n |-- Battalion: string (nullable = true)\n |-- Station Area: string (nullable = true)\n |-- Box: string (nullable = true)\n |-- Suppression Units: integer (nullable = true)\n |-- Suppression Personnel: integer (nullable = true)\n |-- EMS Units: integer (nullable = true)\n |-- EMS Personnel: integer (nullable = true)\n |-- Other Units: integer (nullable = true)\n |-- Other Personnel: integer (nullable = true)\n |-- First Unit On Scene: string (nullable = true)\n |-- Estimated Property Loss: integer (nullable = true)\n |-- Estimated Contents Loss: double (nullable = true)\n |-- Fire Fatalities: integer (nullable = true)\n |-- Fire Injuries: integer (nullable = true)\n |-- Civilian Fatalities: integer (nullable = true)\n |-- Civilian Injuries: integer (nullable = true)\n |-- Number of Alarms: string (nullable = true)\n |-- Primary Situation: string (nullable = true)\n |-- Mutual Aid: string (nullable = true)\n |-- Action Taken Primary: string (nullable = true)\n |-- Action Taken Secondary: string (nullable = true)\n |-- Action Taken Other: string (nullable = true)\n |-- Detector Alerted Occupants: string (nullable = true)\n |-- Property Use: string (nullable = true)\n |-- Area of Fire Origin: string (nullable = true)\n |-- Ignition Cause: string (nullable = true)\n |-- Ignition Factor Primary: string (nullable = true)\n |-- Ignition Factor Secondary: string (nullable = true)\n |-- Heat Source: string (nullable = true)\n |-- Item First Ignited: string (nullable = true)\n |-- Human Factors Associated with Ignition: string (nullable = true)\n |-- Structure Type: string (nullable = true)\n |-- Structure Status: string (nullable = true)\n |-- Floor of Fire Origin: integer (nullable = true)\n |-- Fire Spread: string (nullable = true)\n |-- No Flame Spead: string (nullable = true)\n |-- Number of floors with minimum damage: integer (nullable = true)\n |-- Number of floors with significant damage: integer (nullable = true)\n |-- Number of floors with heavy damage: integer (nullable = true)\n |-- Number of floors with extreme damage: integer (nullable = true)\n |-- Detectors Present: string (nullable = true)\n |-- Detector Type: string (nullable = true)\n |-- Detector Operation: string (nullable = true)\n |-- Detector Effectiveness: string (nullable = true)\n |-- Detector Failure Reason: string (nullable = true)\n |-- Automatic Extinguishing System Present: string (nullable = true)\n |-- Automatic Extinguishing Sytem Type: string (nullable = true)\n |-- Automatic Extinguishing Sytem Perfomance: string (nullable = true)\n |-- Automatic Extinguishing Sytem Failure Reason: string (nullable = true)\n |-- Number of Sprinkler Heads Operating: integer (nullable = true)\n |-- Supervisor District: integer (nullable = true)\n |-- Neighborhood  District: string (nullable = true)\n |-- Location: string (nullable = true)\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498608026336,"submitTime":1498608026328,"finishTime":1498608026409,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d0478dea-412f-4e3b-a143-04a5d4bc65ca"},{"version":"CommandV1","origId":3287337392669048,"guid":"8cfc6e30-bc81-4eb7-aef2-67b7a6993af4","subtype":"command","commandType":"auto","position":12.96875,"command":"# Materialize the cache\nincidentsDF.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">54</span><span class=\"ansired\">]: </span>403470\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: json() got an unexpected keyword argument &apos;inferSchema&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-46-d8fbdb1e559f&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>fireIncidentsDF <span class=\"ansiyellow\">=</span> spark<span class=\"ansiyellow\">.</span>read<span class=\"ansiyellow\">.</span>json<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;/mnt/sf_open_data/fire_incidents/FireIncidents.json&apos;</span><span class=\"ansiyellow\">,</span> inferSchema<span class=\"ansiyellow\">=</span>True<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: json() got an unexpected keyword argument &apos;inferSchema&apos;\n</div>","workflows":[],"startTime":1498608035513,"submitTime":1498608035505,"finishTime":1498608042778,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9b0d72dc-8c4a-4d63-8944-2b2d631a1146"},{"version":"CommandV1","origId":7685207635902,"guid":"3037268d-0ac4-4c4b-8e30-ed31479c3b68","subtype":"command","commandType":"auto","position":13.46875,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1724b8b5-e974-4678-9365-40169d7c7f30"},{"version":"CommandV1","origId":3287337392669049,"guid":"c93f122c-7909-413e-b0dc-f7bc0dd4f7a9","subtype":"command","commandType":"auto","position":13.96875,"command":"display(incidentsDF.limit(3))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[9030109,0,"310 Colon Av.","04/12/2009",91020273,"04/12/2009 06:09:13 PM","04/12/2009 06:13:45 PM","04/12/2009 07:23:13 PM","SF",null,"B09","15",null,1,5,0,0,0,0,"T15",null,null,0,0,0,0,null,"551 - assist pd or other govern. agency","none","52 - forcible entry","-","-","-","000 - property use, other",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[13067402,0,"20 Lansdale Av","07/18/2013",131990117,"07/18/2013 10:32:03 AM","07/18/2013 10:37:15 AM","07/18/2013 10:39:55 AM","SF",null,"B09","39","8571",3,11,0,0,0,0,"E39",null,null,0,0,0,0,null,"745 - alarm system sounded/no fire-accidental","none","86 - investigate","-","-","-","429 - multifamily dwellings",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[12044490,0,"7th St. / Folsom St.","05/13/2012",121340051,"05/13/2012 03:55:37 AM","05/13/2012 04:01:57 AM","05/13/2012 04:05:44 AM","SF",94103,"B03","01",null,3,10,0,0,0,0,"B03",null,null,0,0,0,0,null,"711 - municipal alarm system, street box false","none","86 - investigate","-","-","-","963 - street or road in commercial area",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,6,"South of Market","(37.7767460000297, -122.407844)"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"IncidentNumber","type":"\"integer\"","metadata":"{}"},{"name":"Exposure Number","type":"\"integer\"","metadata":"{}"},{"name":"Address","type":"\"string\"","metadata":"{}"},{"name":"Incident Date","type":"\"string\"","metadata":"{}"},{"name":"Call Number","type":"\"integer\"","metadata":"{}"},{"name":"Alarm DtTm","type":"\"string\"","metadata":"{}"},{"name":"Arrival DtTm","type":"\"string\"","metadata":"{}"},{"name":"Close DtTm","type":"\"string\"","metadata":"{}"},{"name":"City","type":"\"string\"","metadata":"{}"},{"name":"Zipcode","type":"\"integer\"","metadata":"{}"},{"name":"Battalion","type":"\"string\"","metadata":"{}"},{"name":"Station Area","type":"\"string\"","metadata":"{}"},{"name":"Box","type":"\"string\"","metadata":"{}"},{"name":"Suppression Units","type":"\"integer\"","metadata":"{}"},{"name":"Suppression Personnel","type":"\"integer\"","metadata":"{}"},{"name":"EMS Units","type":"\"integer\"","metadata":"{}"},{"name":"EMS Personnel","type":"\"integer\"","metadata":"{}"},{"name":"Other Units","type":"\"integer\"","metadata":"{}"},{"name":"Other Personnel","type":"\"integer\"","metadata":"{}"},{"name":"First Unit On Scene","type":"\"string\"","metadata":"{}"},{"name":"Estimated Property Loss","type":"\"integer\"","metadata":"{}"},{"name":"Estimated Contents Loss","type":"\"double\"","metadata":"{}"},{"name":"Fire Fatalities","type":"\"integer\"","metadata":"{}"},{"name":"Fire Injuries","type":"\"integer\"","metadata":"{}"},{"name":"Civilian Fatalities","type":"\"integer\"","metadata":"{}"},{"name":"Civilian Injuries","type":"\"integer\"","metadata":"{}"},{"name":"Number of Alarms","type":"\"string\"","metadata":"{}"},{"name":"Primary Situation","type":"\"string\"","metadata":"{}"},{"name":"Mutual Aid","type":"\"string\"","metadata":"{}"},{"name":"Action Taken Primary","type":"\"string\"","metadata":"{}"},{"name":"Action Taken Secondary","type":"\"string\"","metadata":"{}"},{"name":"Action Taken Other","type":"\"string\"","metadata":"{}"},{"name":"Detector Alerted Occupants","type":"\"string\"","metadata":"{}"},{"name":"Property Use","type":"\"string\"","metadata":"{}"},{"name":"Area of Fire Origin","type":"\"string\"","metadata":"{}"},{"name":"Ignition Cause","type":"\"string\"","metadata":"{}"},{"name":"Ignition Factor Primary","type":"\"string\"","metadata":"{}"},{"name":"Ignition Factor Secondary","type":"\"string\"","metadata":"{}"},{"name":"Heat Source","type":"\"string\"","metadata":"{}"},{"name":"Item First Ignited","type":"\"string\"","metadata":"{}"},{"name":"Human Factors Associated with Ignition","type":"\"string\"","metadata":"{}"},{"name":"Structure Type","type":"\"string\"","metadata":"{}"},{"name":"Structure Status","type":"\"string\"","metadata":"{}"},{"name":"Floor of Fire Origin","type":"\"integer\"","metadata":"{}"},{"name":"Fire Spread","type":"\"string\"","metadata":"{}"},{"name":"No Flame Spead","type":"\"string\"","metadata":"{}"},{"name":"Number of floors with minimum damage","type":"\"integer\"","metadata":"{}"},{"name":"Number of floors with significant damage","type":"\"integer\"","metadata":"{}"},{"name":"Number of floors with heavy damage","type":"\"integer\"","metadata":"{}"},{"name":"Number of floors with extreme damage","type":"\"integer\"","metadata":"{}"},{"name":"Detectors Present","type":"\"string\"","metadata":"{}"},{"name":"Detector Type","type":"\"string\"","metadata":"{}"},{"name":"Detector Operation","type":"\"string\"","metadata":"{}"},{"name":"Detector Effectiveness","type":"\"string\"","metadata":"{}"},{"name":"Detector Failure Reason","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing System Present","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing Sytem Type","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing Sytem Perfomance","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing Sytem Failure Reason","type":"\"string\"","metadata":"{}"},{"name":"Number of Sprinkler Heads Operating","type":"\"integer\"","metadata":"{}"},{"name":"Supervisor District","type":"\"integer\"","metadata":"{}"},{"name":"Neighborhood  District","type":"\"string\"","metadata":"{}"},{"name":"Location","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498608064000,"submitTime":1498608063991,"finishTime":1498608064352,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"1146","height":"512","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"70639067-6ba7-44b8-b03c-c8e4e65c2ee2"},{"version":"CommandV1","origId":7685207635904,"guid":"32faf562-e358-40b3-8de9-0e126f91fd75","subtype":"command","commandType":"auto","position":14.03125,"command":"%md Do an [inner join](https://www.w3schools.com/sql/sql_join_inner.asp) on the column IncidentNumber between two DataFrames. \nThe inner `join()` DataFrame selects rows that have matching values in both DataFrames. In our case, we will include all columns\nfrom DataFrames fireServiceDF and incidentsDF where their column `incidentNumber` match.\n\nSurely, this will result into a wider DataFrame but fewer rows.\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f285a527-c0e5-4b26-ae31-3d26b25e2e39"},{"version":"CommandV1","origId":3287337392669050,"guid":"ccb33f96-6cd1-4451-a078-d77fd5502828","subtype":"command","commandType":"auto","position":14.09375,"command":"joinedDF = fireServiceDF.join(incidentsDF, fireServiceDF.IncidentNumber == incidentsDF.IncidentNumber)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498608084041,"submitTime":1498608084033,"finishTime":1498608084214,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"10b8ae59-9cce-44e7-8d0c-8d5bfaab1076"},{"version":"CommandV1","origId":7685207635903,"guid":"4a31b8ce-f3a7-4681-9012-0ae1529500da","subtype":"command","commandType":"auto","position":14.15625,"command":"joinedDF.columns","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">63</span><span class=\"ansired\">]: </span>\n[&apos;CallNumber&apos;,\n &apos;UnitID&apos;,\n &apos;IncidentNumber&apos;,\n &apos;CallType&apos;,\n &apos;CallFinalDisposition&apos;,\n &apos;Address&apos;,\n &apos;City&apos;,\n &apos;ZipcodeofIncident&apos;,\n &apos;Battalion&apos;,\n &apos;StationArea&apos;,\n &apos;Box&apos;,\n &apos;OriginalPriority&apos;,\n &apos;Priority&apos;,\n &apos;FinalPriority&apos;,\n &apos;ALSUnit&apos;,\n &apos;CallTypeGroup&apos;,\n &apos;NumberofAlarms&apos;,\n &apos;UnitType&apos;,\n &apos;Unitsequenceincalldispatch&apos;,\n &apos;FirePreventionDistrict&apos;,\n &apos;SupervisorDistrict&apos;,\n &apos;NeighborhoodDistrict&apos;,\n &apos;Location&apos;,\n &apos;RowID&apos;,\n &apos;CallDateTS&apos;,\n &apos;WatchDateTS&apos;,\n &apos;ReceivedDtTmTS&apos;,\n &apos;EntryDtTmTS&apos;,\n &apos;DispatchDtTmTS&apos;,\n &apos;ResponseDtTmTS&apos;,\n &apos;OnSceneDtTmTS&apos;,\n &apos;TransportDtTmTS&apos;,\n &apos;HospitalDtTmTS&apos;,\n &apos;AvailableDtTmTS&apos;,\n &apos;IncidentNumber&apos;,\n &apos;Exposure Number&apos;,\n &apos;Address&apos;,\n &apos;Incident Date&apos;,\n &apos;Call Number&apos;,\n &apos;Alarm DtTm&apos;,\n &apos;Arrival DtTm&apos;,\n &apos;Close DtTm&apos;,\n &apos;City&apos;,\n &apos;Zipcode&apos;,\n &apos;Battalion&apos;,\n &apos;Station Area&apos;,\n &apos;Box&apos;,\n &apos;Suppression Units&apos;,\n &apos;Suppression Personnel&apos;,\n &apos;EMS Units&apos;,\n &apos;EMS Personnel&apos;,\n &apos;Other Units&apos;,\n &apos;Other Personnel&apos;,\n &apos;First Unit On Scene&apos;,\n &apos;Estimated Property Loss&apos;,\n &apos;Estimated Contents Loss&apos;,\n &apos;Fire Fatalities&apos;,\n &apos;Fire Injuries&apos;,\n &apos;Civilian Fatalities&apos;,\n &apos;Civilian Injuries&apos;,\n &apos;Number of Alarms&apos;,\n &apos;Primary Situation&apos;,\n &apos;Mutual Aid&apos;,\n &apos;Action Taken Primary&apos;,\n &apos;Action Taken Secondary&apos;,\n &apos;Action Taken Other&apos;,\n &apos;Detector Alerted Occupants&apos;,\n &apos;Property Use&apos;,\n &apos;Area of Fire Origin&apos;,\n &apos;Ignition Cause&apos;,\n &apos;Ignition Factor Primary&apos;,\n &apos;Ignition Factor Secondary&apos;,\n &apos;Heat Source&apos;,\n &apos;Item First Ignited&apos;,\n &apos;Human Factors Associated with Ignition&apos;,\n &apos;Structure Type&apos;,\n &apos;Structure Status&apos;,\n &apos;Floor of Fire Origin&apos;,\n &apos;Fire Spread&apos;,\n &apos;No Flame Spead&apos;,\n &apos;Number of floors with minimum damage&apos;,\n &apos;Number of floors with significant damage&apos;,\n &apos;Number of floors with heavy damage&apos;,\n &apos;Number of floors with extreme damage&apos;,\n &apos;Detectors Present&apos;,\n &apos;Detector Type&apos;,\n &apos;Detector Operation&apos;,\n &apos;Detector Effectiveness&apos;,\n &apos;Detector Failure Reason&apos;,\n &apos;Automatic Extinguishing System Present&apos;,\n &apos;Automatic Extinguishing Sytem Type&apos;,\n &apos;Automatic Extinguishing Sytem Perfomance&apos;,\n &apos;Automatic Extinguishing Sytem Failure Reason&apos;,\n &apos;Number of Sprinkler Heads Operating&apos;,\n &apos;Supervisor District&apos;,\n &apos;Neighborhood  District&apos;,\n &apos;Location&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498608627815,"submitTime":1498608627790,"finishTime":1498608627886,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fe3af6be-5791-4b61-a92e-f65bd6d65a1b"},{"version":"CommandV1","origId":3287337392669051,"guid":"85eebb29-64f4-4ac2-972e-8da4cf782167","subtype":"command","commandType":"auto","position":14.21875,"command":"display(joinedDF.limit(3))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[30010041,"RC2",3000027,"Medical Incident","Other","0 Block of PARKER AVE","SF",94118,"B07","10","4436","3","3",3,true,null,1,"RESCUE CAPTAIN",3,"7","2","Presidio Heights","(37.7851399842228, -122.454627027921)","030010041-RC2","2003-01-01T00:00:00.000+0000","2002-12-31T00:00:00.000+0000","2003-01-01T00:42:41.000+0000","2003-01-01T00:43:39.000+0000","2003-01-01T00:43:53.000+0000","2016-04-25T21:09:36.000+0000","2016-04-25T21:09:36.000+0000","2016-04-25T21:09:36.000+0000","2016-04-25T21:09:36.000+0000","2003-01-01T00:54:51.000+0000",3000027,0,"2 Parker Av.","01/01/2003",30010041,"01/01/2003 12:43:53 AM","01/01/2003 12:47:00 AM","01/01/2003 01:43:22 AM","SF",null,"B07","10","4436",1,4,1,4,0,0,"E10",0,0.0,0,0,0,0,null,"463 - vehicle accident, general cleanup","none","10 - fire, other","-","-","-","960 - street, other","-","-","-","-","-","-","-","-","-",null,"-",null,null,null,null,null,"-","-","-","-","-","-","-","-","-",null,null,null,null],[30010041,"M38",3000027,"Medical Incident","Other","0 Block of PARKER AVE","SF",94118,"B07","10","4436","3","3",3,true,null,1,"MEDIC",2,"7","2","Presidio Heights","(37.7851399842228, -122.454627027921)","030010041-M38","2003-01-01T00:00:00.000+0000","2002-12-31T00:00:00.000+0000","2003-01-01T00:42:41.000+0000","2003-01-01T00:43:39.000+0000","2003-01-01T00:43:53.000+0000","2003-01-01T00:45:16.000+0000","2003-01-01T00:50:04.000+0000","2003-01-01T01:25:04.000+0000","2003-01-01T01:25:08.000+0000","2003-01-01T00:54:07.000+0000",3000027,0,"2 Parker Av.","01/01/2003",30010041,"01/01/2003 12:43:53 AM","01/01/2003 12:47:00 AM","01/01/2003 01:43:22 AM","SF",null,"B07","10","4436",1,4,1,4,0,0,"E10",0,0.0,0,0,0,0,null,"463 - vehicle accident, general cleanup","none","10 - fire, other","-","-","-","960 - street, other","-","-","-","-","-","-","-","-","-",null,"-",null,null,null,null,null,"-","-","-","-","-","-","-","-","-",null,null,null,null],[30010041,"E10",3000027,"Medical Incident","Other","0 Block of PARKER AVE","SF",94118,"B07","10","4436","3","3",3,true,null,1,"ENGINE",1,"7","2","Presidio Heights","(37.7851399842228, -122.454627027921)","030010041-E10","2003-01-01T00:00:00.000+0000","2002-12-31T00:00:00.000+0000","2003-01-01T00:42:41.000+0000","2003-01-01T00:43:39.000+0000","2003-01-01T00:43:53.000+0000","2003-01-01T00:45:10.000+0000","2003-01-01T00:47:00.000+0000","2016-04-25T21:09:36.000+0000","2016-04-25T21:09:36.000+0000","2003-01-01T00:58:18.000+0000",3000027,0,"2 Parker Av.","01/01/2003",30010041,"01/01/2003 12:43:53 AM","01/01/2003 12:47:00 AM","01/01/2003 01:43:22 AM","SF",null,"B07","10","4436",1,4,1,4,0,0,"E10",0,0.0,0,0,0,0,null,"463 - vehicle accident, general cleanup","none","10 - fire, other","-","-","-","960 - street, other","-","-","-","-","-","-","-","-","-",null,"-",null,null,null,null,null,"-","-","-","-","-","-","-","-","-",null,null,null,null]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"CallNumber","type":"\"integer\"","metadata":"{}"},{"name":"UnitID","type":"\"string\"","metadata":"{}"},{"name":"IncidentNumber","type":"\"integer\"","metadata":"{}"},{"name":"CallType","type":"\"string\"","metadata":"{}"},{"name":"CallFinalDisposition","type":"\"string\"","metadata":"{}"},{"name":"Address","type":"\"string\"","metadata":"{}"},{"name":"City","type":"\"string\"","metadata":"{}"},{"name":"ZipcodeofIncident","type":"\"integer\"","metadata":"{}"},{"name":"Battalion","type":"\"string\"","metadata":"{}"},{"name":"StationArea","type":"\"string\"","metadata":"{}"},{"name":"Box","type":"\"string\"","metadata":"{}"},{"name":"OriginalPriority","type":"\"string\"","metadata":"{}"},{"name":"Priority","type":"\"string\"","metadata":"{}"},{"name":"FinalPriority","type":"\"integer\"","metadata":"{}"},{"name":"ALSUnit","type":"\"boolean\"","metadata":"{}"},{"name":"CallTypeGroup","type":"\"string\"","metadata":"{}"},{"name":"NumberofAlarms","type":"\"integer\"","metadata":"{}"},{"name":"UnitType","type":"\"string\"","metadata":"{}"},{"name":"Unitsequenceincalldispatch","type":"\"integer\"","metadata":"{}"},{"name":"FirePreventionDistrict","type":"\"string\"","metadata":"{}"},{"name":"SupervisorDistrict","type":"\"string\"","metadata":"{}"},{"name":"NeighborhoodDistrict","type":"\"string\"","metadata":"{}"},{"name":"Location","type":"\"string\"","metadata":"{}"},{"name":"RowID","type":"\"string\"","metadata":"{}"},{"name":"CallDateTS","type":"\"timestamp\"","metadata":"{}"},{"name":"WatchDateTS","type":"\"timestamp\"","metadata":"{}"},{"name":"ReceivedDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"EntryDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"DispatchDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"ResponseDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"OnSceneDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"TransportDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"HospitalDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"AvailableDtTmTS","type":"\"timestamp\"","metadata":"{}"},{"name":"IncidentNumber","type":"\"integer\"","metadata":"{}"},{"name":"Exposure Number","type":"\"integer\"","metadata":"{}"},{"name":"Address","type":"\"string\"","metadata":"{}"},{"name":"Incident Date","type":"\"string\"","metadata":"{}"},{"name":"Call Number","type":"\"integer\"","metadata":"{}"},{"name":"Alarm DtTm","type":"\"string\"","metadata":"{}"},{"name":"Arrival DtTm","type":"\"string\"","metadata":"{}"},{"name":"Close DtTm","type":"\"string\"","metadata":"{}"},{"name":"City","type":"\"string\"","metadata":"{}"},{"name":"Zipcode","type":"\"integer\"","metadata":"{}"},{"name":"Battalion","type":"\"string\"","metadata":"{}"},{"name":"Station Area","type":"\"string\"","metadata":"{}"},{"name":"Box","type":"\"string\"","metadata":"{}"},{"name":"Suppression Units","type":"\"integer\"","metadata":"{}"},{"name":"Suppression Personnel","type":"\"integer\"","metadata":"{}"},{"name":"EMS Units","type":"\"integer\"","metadata":"{}"},{"name":"EMS Personnel","type":"\"integer\"","metadata":"{}"},{"name":"Other Units","type":"\"integer\"","metadata":"{}"},{"name":"Other Personnel","type":"\"integer\"","metadata":"{}"},{"name":"First Unit On Scene","type":"\"string\"","metadata":"{}"},{"name":"Estimated Property Loss","type":"\"integer\"","metadata":"{}"},{"name":"Estimated Contents Loss","type":"\"double\"","metadata":"{}"},{"name":"Fire Fatalities","type":"\"integer\"","metadata":"{}"},{"name":"Fire Injuries","type":"\"integer\"","metadata":"{}"},{"name":"Civilian Fatalities","type":"\"integer\"","metadata":"{}"},{"name":"Civilian Injuries","type":"\"integer\"","metadata":"{}"},{"name":"Number of Alarms","type":"\"string\"","metadata":"{}"},{"name":"Primary Situation","type":"\"string\"","metadata":"{}"},{"name":"Mutual Aid","type":"\"string\"","metadata":"{}"},{"name":"Action Taken Primary","type":"\"string\"","metadata":"{}"},{"name":"Action Taken Secondary","type":"\"string\"","metadata":"{}"},{"name":"Action Taken Other","type":"\"string\"","metadata":"{}"},{"name":"Detector Alerted Occupants","type":"\"string\"","metadata":"{}"},{"name":"Property Use","type":"\"string\"","metadata":"{}"},{"name":"Area of Fire Origin","type":"\"string\"","metadata":"{}"},{"name":"Ignition Cause","type":"\"string\"","metadata":"{}"},{"name":"Ignition Factor Primary","type":"\"string\"","metadata":"{}"},{"name":"Ignition Factor Secondary","type":"\"string\"","metadata":"{}"},{"name":"Heat Source","type":"\"string\"","metadata":"{}"},{"name":"Item First Ignited","type":"\"string\"","metadata":"{}"},{"name":"Human Factors Associated with Ignition","type":"\"string\"","metadata":"{}"},{"name":"Structure Type","type":"\"string\"","metadata":"{}"},{"name":"Structure Status","type":"\"string\"","metadata":"{}"},{"name":"Floor of Fire Origin","type":"\"integer\"","metadata":"{}"},{"name":"Fire Spread","type":"\"string\"","metadata":"{}"},{"name":"No Flame Spead","type":"\"string\"","metadata":"{}"},{"name":"Number of floors with minimum damage","type":"\"integer\"","metadata":"{}"},{"name":"Number of floors with significant damage","type":"\"integer\"","metadata":"{}"},{"name":"Number of floors with heavy damage","type":"\"integer\"","metadata":"{}"},{"name":"Number of floors with extreme damage","type":"\"integer\"","metadata":"{}"},{"name":"Detectors Present","type":"\"string\"","metadata":"{}"},{"name":"Detector Type","type":"\"string\"","metadata":"{}"},{"name":"Detector Operation","type":"\"string\"","metadata":"{}"},{"name":"Detector Effectiveness","type":"\"string\"","metadata":"{}"},{"name":"Detector Failure Reason","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing System Present","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing Sytem Type","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing Sytem Perfomance","type":"\"string\"","metadata":"{}"},{"name":"Automatic Extinguishing Sytem Failure Reason","type":"\"string\"","metadata":"{}"},{"name":"Number of Sprinkler Heads Operating","type":"\"integer\"","metadata":"{}"},{"name":"Supervisor District","type":"\"integer\"","metadata":"{}"},{"name":"Neighborhood  District","type":"\"string\"","metadata":"{}"},{"name":"Location","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498608129898,"submitTime":1498608129888,"finishTime":1498608147715,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"864e6b49-aeae-489c-b22c-3037bd50a984"},{"version":"CommandV1","origId":3287337392669052,"guid":"84c240e7-ff40-4675-86e9-18caa0ceb7a4","subtype":"command","commandType":"auto","position":14.234375,"command":"#Note that the joined DF is only 1.1 million rows because we did an inner join (the original Fire Service Calls data had 4+ million rows)\njoinedDF.count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">64</span><span class=\"ansired\">]: </span>1163608\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498609088709,"submitTime":1498609088684,"finishTime":1498609089584,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"84b534f8-1a82-44d1-ac8d-8499ece8e6ab"},{"version":"CommandV1","origId":7685207635905,"guid":"c4a53f78-f951-4743-bd83-a4389e53696a","subtype":"command","commandType":"auto","position":14.2421875,"command":"%md What's the count of Tenderloin districts in the joined DataFrame?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a396949b-6f52-4f89-aadd-f5d9aee564c4"},{"version":"CommandV1","origId":3287337392669053,"guid":"40a3b87f-67cc-4a22-bca1-e55280d58851","subtype":"command","commandType":"auto","position":14.25,"command":"joinedDF.filter(year('CallDateTS') == '2015') \\\n      .filter(col('NeighborhoodDistrict') == 'Tenderloin') \\\n      .count()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">67</span><span class=\"ansired\">]: </span>8672\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> unexpected EOF while parsing","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;ipython-input-83-be14a792ce6e&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">1</span>\n<span class=\"ansiyellow\">    display(joinedDF.filter(year(&apos;CallDateTS&apos;) == &apos;2015&apos;).filter(col(&apos;NeighborhoodDistrict&apos;) == &apos;Tenderloin&apos;).count()</span>\n<span class=\"ansigrey\">                                                                                                                     ^</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> unexpected EOF while parsing\n\n</div>","workflows":[],"startTime":1498609267863,"submitTime":1498609267837,"finishTime":1498609268971,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bbd7581b-37f5-4c80-bc3f-97c6c7d721b3"},{"version":"CommandV1","origId":7685207635906,"guid":"8a923053-56a0-4151-826e-4512eb7f82af","subtype":"command","commandType":"auto","position":14.265625,"command":"%md Now the last bit where where we ascertain what was the `Primary Situation` that resulted into the Fire Service Call from the Tenderloin District?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cd3552af-fe83-46ad-a5c7-fb9494dfe28c"},{"version":"CommandV1","origId":3287337392669054,"guid":"6349c122-7895-4e79-8fa4-84e3f6d06945","subtype":"command","commandType":"auto","position":14.28125,"command":"display(joinedDF.filter(year('CallDateTS') == '2015') \\\n        .filter(col('NeighborhoodDistrict') == 'Tenderloin') \\\n        .groupBy('Primary Situation') \\\n        .count() \\\n        .orderBy(desc(\"count\")) \\\n        .limit(10))","commandVersion":0,"state":"finished","results":{"type":"table","data":[["700 false alarm or false call, other",1389],["711 municipal alarm system, malicious false alarm",1012],["743 smoke detector activation, no fire - unintentional",574],["735 alarm system sounded due to malfunction",569],["500 service call, other",489],["113 cooking fire, confined to container",489],["745 alarm system activation, no fire - unintentional",438],["733 smoke detector activation due to malfunction",404],["100 fire, other",190],["600 good intent call, other",179]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"Primary Situation","type":"\"string\"","metadata":"{}"},{"name":"count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498609336146,"submitTime":1498609336121,"finishTime":1498609337616,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"35b6e458-dc23-4d9c-bf1d-73756e371f01"},{"version":"CommandV1","origId":3287337392669055,"guid":"18de0a82-0fd4-4bbb-9888-fc8c6785b389","subtype":"command","commandType":"auto","position":14.34375,"command":"%md Most of the calls were False Alarms!","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"571aca5e-5004-4fda-9e43-dcb508a6f553"},{"version":"CommandV1","origId":3287337392669056,"guid":"8b3fbcb9-5522-42e5-a046-d28ccf08501c","subtype":"command","commandType":"auto","position":14.375,"command":"%md What do residents of Russian Hill call the fire department for?","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e7e05f2c-02bd-43dc-b231-2a0c784b54f3"},{"version":"CommandV1","origId":3287337392669057,"guid":"743a212a-6f1f-4039-9d26-d2f8385ebc2c","subtype":"command","commandType":"auto","position":14.40625,"command":"display(joinedDF.filter(year('CallDateTS') == '2015') \\\n        .filter(col('NeighborhoodDistrict') == 'Russian Hill') \\\n        .groupBy('Primary Situation') \\\n        .count() \\\n        .orderBy(desc(\"count\")) \\\n        .limit(10))","commandVersion":0,"state":"finished","results":{"type":"table","data":[["500 service call, other",332],["700 false alarm or false call, other",320],["711 municipal alarm system, malicious false alarm",144],["111 building fire",104],["322 motor vehicle accident with injuries",94],["113 cooking fire, confined to container",79],["100 fire, other",61],["745 alarm system activation, no fire - unintentional",60],["600 good intent call, other",57],["323 motor vehicle/pedestrian accident (mv ped)",54]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"Primary Situation","type":"\"string\"","metadata":"{}"},{"name":"count","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1498609378836,"submitTime":1498609378829,"finishTime":1498609380193,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d5347dd7-d9a3-431f-9629-8413da790312"},{"version":"CommandV1","origId":7685207635907,"guid":"6e839f5b-ff7d-4814-ac55-3093170d6020","subtype":"command","commandType":"auto","position":16.6875,"command":"%md #### UBER CHALLENGE: Can you convert this into Scala code and use Datasets?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"02b45540-38ab-46d7-b9c9-8165385ca38b"},{"version":"CommandV1","origId":3287337392669064,"guid":"95b03ef9-20ca-4622-a1b7-2cd2a9c4d5a1","subtype":"command","commandType":"auto","position":18.96875,"command":"%md ### ** Keep Hacking! **","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d624db0a-5905-43f4-9f99-6ae00ad9f88c"}],"dashboards":[],"guid":"45441c60-a6ae-43fb-adbd-b7e666e9c72e","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
<script>var tableOfContentsCell = {"version":"CommandV1","origId":0,"guid":"ffb57b86-210d-4180-b47a-4742aa243965","subtype":"command","commandType":"auto","position":0.0,"command":"%md [&lsaquo; Back to Table of Contents](index.html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{}};</script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>